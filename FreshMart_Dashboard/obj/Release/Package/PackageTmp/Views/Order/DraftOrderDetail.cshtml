@model Data.order
@using Data;
@using Data.Providers;
@{
    ViewBag.Title = "Chi tiết đơn hàng nháp #" + Model.order_id;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@{
    var current_datetime = System.DateTime.Now;
}

<!-- begin row -->
<div class="row">
    <div class="col-md-12 m-b-30">
        <!-- begin page title -->
        <div class="d-block d-sm-flex flex-nowrap align-items-center">
            <div class="page-title mb-2 mb-sm-0">
                <h1>
                    Đơn hàng nháp /
                    <strong>
                        Cập nhật bởi <span class="text-info" id="text_header_user_update">@ViewBag.UsernameUpdate</span>
                        lúc
                        @if (Model.update_datetime.Value.Date == current_datetime.Date)
                        {
                            <span id="text_header_datetime_update">Hôm nay @Model.update_datetime.Value.ToString("HH:mm")</span>
                        }
                        else if (Model.update_datetime.Value.Date == current_datetime.Date.AddDays(1))
                        {
                            <span id="text_header_datetime_update">Ngày mai @Model.update_datetime.Value.ToString("HH:mm")</span>
                        }
                        else if (Model.update_datetime.Value.Date == current_datetime.Date.AddDays(-1))
                        {
                            <span id="text_header_datetime_update">Hôm qua @Model.update_datetime.Value.ToString("HH:mm")</span>
                        }
                        else
                        {
                            <span id="text_header_datetime_update">Ngày @Model.update_datetime.Value.ToString("dd/M/yyyy") @Model.update_datetime.Value.ToString("HH:mm")</span>
                        }

                    </strong>
                </h1>
            </div>
            <div class="ml-auto d-flex align-items-center">
                <nav>
                    <ol class="breadcrumb p-0 m-b-0">
                        <li class="breadcrumb-item">
                            <a href="/Home/Index"><i class="ti ti-home"></i></a>
                        </li>
                        <li class="breadcrumb-item">
                            Đơn hàng
                        </li>
                        <li class="breadcrumb-item" aria-current="page">Đơn hàng nháp</li>
                        <li class="breadcrumb-item active text-primary" aria-current="page">#@Model.order_id</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!-- end page title -->
    </div>
</div>
<!-- end row -->

<div class="row" id="">
    <div class="col-xxl-8">
        <div class="card card-statistics">
            <div class="card-header">
                <div class="card-heading">
                    <h4 class="card-title">Chi tiết đơn hàng</h4>
                </div>
            </div>
            <div class="card-body">
                <div class="tab tab-border nav-left" id="tab_select_product_for_order" style="padding-bottom: 20px;">
                    <ul class="nav nav-tabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active show" id="search_product_tab" data-toggle="tab" href="#search_product" role="tab" aria-controls="search_product" aria-selected="true"> <i class="fa fa-search"></i> Tìm kiếm sản phẩm trong kho</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="create_product_for_order_tab" data-toggle="tab" href="#create_product_for_order" role="tab" aria-controls="create_product_for_order" aria-selected="false"><i class="fa fa-pencil"></i> Tạo sản phẩm tùy ý </a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane fade active show" id="search_product" role="tabpanel" aria-labelledby="search_product_tab">
                            @*Header of product search*@
                            <div class="input-group mb-3">
                                <form id="form_filter">
                                    <div class="btn-group">
                                        <select class="custom-select" id="select-filter">
                                            <option value="all" selected="">Lọc sản phẩm theo</option>
                                            <option value="product_status">Trạng thái sản phẩm</option>
                                            <option value="category">Danh mục sản phẩm</option>
                                            <option value="supplier">Nhà cung cấp</option>
                                        </select>

                                        <select class="custom-select" id="filter-by-product-status" style="display: none">
                                            <option selected="" value="-1" disabled>Chọn điều kiện lọc...</option>
                                            <option value="hidden">Đang ẩn</option>
                                            <option value="show">Đang hiển thị</option>
                                        </select>

                                        <select class="custom-select" id="filter-by-category" style="display: none;">
                                            <option selected="" disabled>Chọn điều kiện lọc...</option>
                                            @foreach (var category in new CategoryProvider().getAll())
                                            {
                                                <option value="@category.category_name">@category.category_name</option>
                                            }
                                        </select>

                                        <select class="custom-select" id="filter-by-supplier" style="display: none">
                                            <option selected="" disabled>Chọn điều kiện lọc...</option>
                                            @foreach (var supplier in new SupplierProvider().getAll())
                                            {
                                                <option value="@supplier.supplier_name">@supplier.supplier_name</option>
                                            }
                                        </select>
                                    </div>
                                </form>

                                <input type="text" class="form-control" id="search_input" name="search_input" value="@ViewBag.FilterValue" placeholder="Tìm kiếm sản phẩm theo tên..." aria-describedby="button-addon2">
                                <div class="input-group-append">
                                    <button class="btn btn-primary" type="button" id="button-addon2">
                                        <i class="nav-icon ti ti-search"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="" id="data_table_not_action">
                                @{Html.RenderAction("GetProductNotAction", "Product", new { page_num = ViewBag.page_num, search_string = ViewBag.FilterValue });}
                            </div>
                        </div>
                        <div class="tab-pane fade" id="create_product_for_order" role="tabpanel" aria-labelledby="create_product_for_order_tab">
                            <form id="form_add_new_product_for_order">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="control-label" for="new_product_name">Tên sản phẩm</label>
                                            <div class="mb-2">
                                                <input type="text" class="form-control" placeholder="Nhập tên sản phẩm" id="new_product_name">
                                                <div class="invalid-feedback" id="new_product_name_feedback">
                                                    Yêu cầu nhập tên sản phẩm.
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group bs-select-1">
                                            <label class="control-label" for="new_product_unit_id">Đơn vị</label>
                                            <select class="custom-select" id="new_product_unit_id" style="border-radius: .25rem;">
                                                @foreach (var unit in ViewData["ListUnit"] as List<unit>)
                                                {
                                                    <option value="@unit.unit_id">@unit.unit_name</option>
                                                }
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="control-label" for="new_product_price_input">Giá sản phẩm</label>
                                            <div class="mb-2">
                                                <input type="text" class="form-control autoNumericInput" placeholder="Nhập giá sản phẩm" id="new_product_price_input">
                                                <div class="invalid-feedback" id="new_product_price_input_feedback">
                                                    Yêu cầu nhập giá sản phẩm.
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="control-label" for="product_name">Số lượng</label>
                                            <div class="mb-2">
                                                <input type="text" class="form-control quantity_input" id="new_product_quantity" placeholder="Nhập số lượng" value="1">
                                                <div class="invalid-feedback" id="new_product_quantity_feedback">
                                                    Số lượng sản phẩm này trên hóa đơn phải lớn hơn <strong>0</strong> và nhỏ hơn <strong>10.000</strong>.
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                            <div id="div_btn_form_create_product_in_order">
                                <a href="javascript:void(0);" class="btn btn-secondary" onclick="resetForm()">Reset Form</a>
                                <a href="javascript:void(0);" class="btn btn-primary" onclick="addNewProductForOrder()">Tạo và chọn sản phẩm</a>
                            </div>
                        </div>

                    </div>
                </div>
                @*div append*@
                <div id="div_list_product_selected">
                    <label for="div_product_selected" id="title_dive_list_product_in_order">Danh sách sản phẩm đã lựa chọn cho hóa đơn này</label>
                    <div class="div_product_selected">
                        <div class="table-responsive">
                            <table class="table mb-0">
                                <thead>
                                    <tr>
                                        <th scope="col" style="width:10%;"></th>
                                        <th scope="col" style="width:25%;">
                                            Tên sản phẩm
                                        </th>
                                        <th scope="col" style="width:10%;">
                                            Giá niêm yết
                                        </th>
                                        <th scope="col" style="width:35%;">
                                            Số lượng
                                        </th>
                                        <th scope="col" style="width:5%;">
                                            Đơn vị
                                        </th>
                                        <th scope="col" style="width:10%;">
                                            Tổng giá 1 sản phẩm
                                        </th>
                                        <th scope="col" style="width:5%;" align="center">Xóa</th>
                                    </tr>

                                </thead>
                                <tbody id="table_list_product_selected"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-5">
                        <form>
                            <div class="form-group">
                                <label class="control-label" for="order_note">Ghi chú</label>
                                <div class="mb-2">
                                    <textarea class="form-control" id="order_note" placeholder="Ghi chú đơn hàng" name="order_note" rows="3">@ViewBag.DraftOrderDetail.order_note</textarea>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="col-md-7">
                        <label class="control-label" for="product_description">Hóa đơn bao gồm</label>
                        <table class="table mb-0" id="table_cost_order">
                            <thead style="display: none">
                                <tr>
                                    <th style="width: 40%"></th>
                                    <th style="width: 20%"></th>
                                    <th style="width: 40%"></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Tổng giá trị các sản phẩm</td>
                                    <td></td>
                                    <td id="sum_in_all_product" class="showNumeric"></td>
                                </tr>
                                <tr>
                                    <td id="label_promotion">
                                        Khuyến mãi / Ưu đãi <br />
                                        <div id="label_small_reason_promotion" style="display: none">
                                            <small class="text-info" id="text_reason_promotion"></small>
                                        </div>
                                    </td>
                                    <td class="add_field">
                                        <a href="javascript:void(0)" class="text-primary" onclick="addPromotion()"><i class="fa fa-edit" id="promotion_value_icon"></i></a>
                                        <a href="javascript:void(0)" class="text-primary" onclick="addPromotion()" id="promotion_value_action"> Thêm</a>
                                    </td>
                                    <td id="promotion_value" class="showNumeric"></td>
                                </tr>
                                <tr>
                                    <td id="label_shipping_price">
                                        Chi phí vận chuyển <br /> <div id="label_small_name_of_shipping" style="display: none">
                                            <small class="text-info" id="text_name_of_shipping"></small>
                                        </div>
                                    </td>
                                    <td class="add_field">
                                        <a href="javascript:void(0)" class="text-primary" onclick="addShippingPrice()"><i class="fa fa-edit" id="shipping_price_icon"></i></a>
                                        <a href="javascript:void(0)" class="text-primary" onclick="addShippingPrice()" id="shipping_price_action"> Thêm</a>
                                    </td>
                                    <td id="ship_price" class="showNumeric"></td>
                                </tr>
                                <tr>
                                    <td class="font-weight-bold text-danger">Tổng chi phí hóa đơn phải trả</td>
                                    <td></td>
                                    <td class="font-weight-bold text-danger showNumeric" id="total_in_order"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="line_div"></div>
                <div class="row">
                    <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6" id="label_div_btn_payment">
                        <a class="font-18 text-info"><i class="fa fa-credit-card-alt"></i></a> &nbsp;
                        <label class="font-bold"> XÁC NHẬN TÌNH TRẠNG THANH TOÁN VÀ TẠO ĐƠN HÀNG </label>
                    </div>
                    <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6" id="div_btn_payment">
                        <a href="javascript:void(0);" class="btn btn-primary disabled" id="btn_is_paid" onclick="isPaid()">Đã thanh toán</a>
                        <a href="javascript:void(0);" class="btn btn-primary disabled" id="btn_is_pending" onclick="isPending()">Thanh toán sau</a>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="col-xxl-4">
        @if (ViewBag.Customer == null)
        {
            <div class="">
                <div class="card mb-0 o-hidden">
                    <div class="card-header">
                        <div class="card-heading">
                            <div class="row">
                                <div class="col-md-8">
                                    <h4 class="card-title">Thông tin khách hàng</h4>
                                </div>
                                <div class="col-md-4 div-card-title-right">
                                    <a id="search_customer_in_list_from_db" href="javascript:void(0);" class="btn btn-icon btn-xs btn-inverse-primary" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Tìm trong dữ liệu khách hàng"><i class="fa fa-search"></i></a>
                                    <a onclick="createNewCustomer()" id="btn_show_modal_create_customer" href="javascript:void(0);" class="btn btn-icon btn-xs btn-inverse-primary" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Tạo khách hàng mới"><i class="fa fa-plus"></i></a>
                                    <a onclick="removeCustomerSelected()" id="btn_remove_customer_selected" href="javascript:void(0);" class="btn btn-icon btn-xs btn-inverse-secondary hidden_element" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Xóa khách hàng khỏi đơn hàng"><i class="fa fa-times"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body selects-contant-boots" id="column_right_select_customer">
                        <div id="div_customer_null">
                            <img class="img_column_right" src="~/Assets/images/image_system/order_img1.png" />
                            <h5>Chưa có khách hàng nào được chọn</h5>
                        </div>
                        <div class="contact-contant hidden_element" id="div_contact_customer_selected">
                            <div class="py-4">
                                <div class="d-flex align-items-center">
                                    <div class="bg-img avatar_profile_customer">
                                        <img src="~/Assets/img/avatar/AvatarCustomerProfile.png" class="img-fluid" />
                                    </div>
                                    <div class="ml-3">
                                        <h4 class="mb-0"><a class="text-primary" id="info_customer_fullname"></a></h4>
                                        <h4><span class="badge badge-info-inverse px-2 py-1 mt-1"><i class="fa fa-bookmark"></i>&nbsp;&nbsp; <span><a id="info_number_of_order"></a> đơn hàng</span></span></h4>
                                    </div>
                                </div>
                                <div>
                                    <div class="row">
                                        <div class="col-md-8">
                                            <ul class="nav">
                                                <li class="nav-item">
                                                    <div class="img-icon"><i class="fa fa-envelope-o"></i></div>
                                                </li>
                                                <li class="nav-item">
                                                    <a id="info_customer_email"></a>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="col-md-4" id="div_icon_edit_email_in_order">
                                            <a onclick="editEmailInOrder()" class="tooltip-wrapper card-title text-primary" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Sửa Email" href="javascript:void(0)" id=""><i class="icon_nav fa fa-edit"></i></a>
                                        </div>
                                    </div>

                                    <ul class="nav">
                                        <li class="nav-item">
                                            <div class="img-icon"><i class="fa fa-phone"></i></div>
                                        </li>
                                        <li class="nav-item">
                                            <a id="info_customer_phone_number"></a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="cardRightBottom hidden_element" id="card_delivery_address">
                <div class="card mb-0 o-hidden">
                    <div class="card-header">
                        <div class="card-heading">
                            <div class="row">
                                <div class="col-md-8">
                                    <h4 class="card-title">Địa chỉ giao hàng</h4>
                                </div>
                                <div class="col-md-4 div-card-title-right">
                                    <a onclick="editDeliveryAddress()" href="javascript:void(0);" class="btn btn-icon btn-xs btn-inverse-primary" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Sửa địa chỉ giao hàng"><i class="fa fa-edit"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body selects-contant-boots">
                        <div class="table-responsive" id="table_delivery_address">
                            <table class="table table-borderless mb-0">
                                <tbody>
                                    <tr>
                                        <td class="font-bold">Họ Tên:</td>
                                        <td id="text_fullname"></td>
                                    </tr>
                                    <tr>
                                        <td class="font-bold">Điện thoại:</td>
                                        <td id="text_phone_number"></td>
                                    </tr>
                                    <tr>
                                        <td class="font-bold">Tỉnh/Thành phố:</td>
                                        <td id="text_province"></td>
                                        <td id="text_province_id" class="hidden_element"></td>
                                    </tr>
                                    <tr>
                                        <td class="font-bold">Quận/Huyện/Thị xã:</td>
                                        <td id="text_district"></td>
                                        <td id="text_district_id" class="hidden_element"></td>
                                    </tr>
                                    <tr>
                                        <td class="font-bold">Xã/Phường/Thị trấn:</td>
                                        <td id="text_ward"></td>
                                        <td id="text_ward_id" class="hidden_element"></td>
                                    </tr>
                                    <tr>
                                        <td class="font-bold">Địa chỉ chi tiết:</td>
                                        <td id="text_address_detail"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        }
        else
        {
            <div class="">
                <div class="card mb-0 o-hidden">
                    <div class="card-header">
                        <div class="card-heading">
                            <div class="row">
                                <div class="col-md-8">
                                    <h4 class="card-title">Thông tin khách hàng</h4>
                                </div>
                                <div class="col-md-4 div-card-title-right">
                                    <a id="search_customer_in_list_from_db" href="javascript:void(0);" class="btn btn-icon btn-xs btn-inverse-primary" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Tìm trong dữ liệu khách hàng"><i class="fa fa-search"></i></a>
                                    <a onclick="createNewCustomer()" id="btn_show_modal_create_customer" href="javascript:void(0);" class="btn btn-icon btn-xs btn-inverse-primary hidden_element" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Tạo khách hàng mới"><i class="fa fa-plus"></i></a>
                                    <a onclick="removeCustomerSelected()" id="btn_remove_customer_selected" href="javascript:void(0);" class="btn btn-icon btn-xs btn-inverse-secondary" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Xóa khách hàng khỏi đơn hàng"><i class="fa fa-times"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body selects-contant-boots" id="column_right_select_customer">
                        <div id="div_customer_null" style="display:none">
                            <img class="img_column_right" src="~/Assets/images/image_system/order_img1.png" />
                            <h5>Chưa có khách hàng nào được chọn</h5>
                        </div>
                        <div class="contact-contant" id="div_contact_customer_selected">
                            <div class="py-4">
                                <div class="d-flex align-items-center">
                                    <div class="bg-img avatar_profile_customer">
                                        <img src="~/Assets/img/avatar/AvatarCustomerProfile.png" class="img-fluid" />
                                    </div>
                                    <div class="ml-3">
                                        <h4 class="mb-0"><a class="text-primary" id="info_customer_fullname">@ViewBag.Customer.customer_first_name @ViewBag.Customer.customer_last_name</a></h4>
                                        <h4>
                                            <span class="badge badge-info-inverse px-2 py-1 mt-1">
                                                <i class="fa fa-bookmark"></i>&nbsp;&nbsp;
                                                <span>
                                                    @if (ViewBag.NumberOfOrderCustomer == 0)
                                                    {
                                                        <a id="info_number_of_order">Chưa có </a>
                                                    }
                                                    else
                                                    {
                                                        <a id="info_number_of_order">@ViewBag.NumberOfOrderCustomer</a>
                                                    }
                                                    đơn hàng
                                                </span>
                                            </span>
                                        </h4>
                                    </div>
                                </div>
                                <div>
                                    <div class="row">
                                        <div class="col-md-8">
                                            <ul class="nav">
                                                <li class="nav-item">
                                                    <div class="img-icon"><i class="fa fa-envelope-o"></i></div>
                                                </li>
                                                <li class="nav-item">
                                                    <a id="info_customer_email">@ViewBag.Customer.customer_email</a>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="col-md-4" id="div_icon_edit_email_in_order">
                                            <a onclick="editEmailInOrder()" class="tooltip-wrapper card-title text-primary" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Sửa Email" href="javascript:void(0)" id=""><i class="icon_nav fa fa-edit"></i></a>
                                        </div>
                                    </div>

                                    <ul class="nav">
                                        <li class="nav-item">
                                            <div class="img-icon"><i class="fa fa-phone"></i></div>
                                        </li>
                                        <li class="nav-item">
                                            <a id="info_customer_phone_number">@ViewBag.Customer.customer_phone_number</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="cardRightBottom" id="card_delivery_address">
                <div class="card mb-0 o-hidden">
                    <div class="card-header">
                        <div class="card-heading">
                            <div class="row">
                                <div class="col-md-8">
                                    <h4 class="card-title">Địa chỉ giao hàng</h4>
                                </div>
                                <div class="col-md-4 div-card-title-right">
                                    <a onclick="editDeliveryAddress()" href="javascript:void(0);" class="btn btn-icon btn-xs btn-inverse-primary" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Sửa địa chỉ giao hàng"><i class="fa fa-edit"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body selects-contant-boots">
                        <div class="table-responsive" id="table_delivery_address">
                            <table class="table table-borderless mb-0">
                                <tbody>
                                    <tr>
                                        <td class="font-bold">Họ Tên:</td>
                                        <td><span id="text_firstname">@ViewBag.DeliveryAddress.first_name</span> <span id="text_lastname">@ViewBag.DeliveryAddress.last_name</span></td>
                                    </tr>
                                    <tr>
                                        <td class="font-bold">Điện thoại:</td>
                                        <td id="text_phone_number">@ViewBag.DeliveryAddress.phone_number</td>
                                    </tr>
                                    <tr>
                                        <td class="font-bold">Tỉnh/Thành phố:</td>
                                        <td id="text_province">@ViewBag.DeliveryAddressProvince</td>
                                        <td id="text_province_id" class="hidden_element">@ViewBag.DeliveryAddress.province_id</td>
                                    </tr>
                                    <tr>
                                        <td class="font-bold">Quận/Huyện/Thị xã:</td>
                                        <td id="text_district">@ViewBag.DeliveryAddressDistrict</td>
                                        <td id="text_district_id" class="hidden_element">@ViewBag.DeliveryAddress.district_id</td>
                                    </tr>
                                    <tr>
                                        <td class="font-bold">Xã/Phường/Thị trấn:</td>
                                        <td id="text_ward">@ViewBag.DeliveryAddressWard</td>
                                        <td id="text_ward_id" class="hidden_element">@ViewBag.DeliveryAddress.ward_id</td>
                                    </tr>
                                    <tr>
                                        <td class="font-bold">Địa chỉ chi tiết:</td>
                                        <td id="text_address_detail">@ViewBag.DeliveryAddress.address_detail</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade hide in" data-keyboard="false" data-backdrop="static" id="modalConfirmDeliveryAddress" tabindex="-1" role="dialog" aria-labelledby="defaultModal" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                Cập nhật địa chỉ giao hàng
                            </h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="cancelModalConfirmDeliveryAddress()">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form>
                                <div class="dropdown">
                                    <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        Lựa chọn địa chỉ giao hàng gợi ý
                                    </button>
                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="dropdown_select_delivery_address">
                                        @if (ViewData["ListDeliveryAddress"] != null)
                                        {
                                            foreach (var da in ViewData["ListDeliveryAddress"] as List<delivery_address>)
                                            {
                                                <a class="dropdown-item" id="da_id_@da.delivery_address_id" href="javascript:void(0)" onclick="getDeliveryAddressExist('@da.delivery_address_id')">
                                                    <span>
                                                        <i class="ti ti-user text-info"></i> &nbsp;&nbsp; <span id="da_name_@da.delivery_address_id">@da.first_name @da.last_name</span>
                                                    </span> <br />
                                                    <span>
                                                        <i class="ti ti-mobile text-info"></i>&nbsp;&nbsp; <span id="da_phone_number_@da.delivery_address_id">@da.phone_number</span>
                                                    </span> <br />
                                                    <span>
                                                        <i class="ti ti-flag text-info"></i>&nbsp;&nbsp; <span id="da_country_@da.delivery_address_id">Việt Nam</span>
                                                    </span> <br />
                                                    <span>
                                                        <i class="ti ti-home text-info"></i>&nbsp;&nbsp;
                                                        <span id="da_home_@da.delivery_address_id">
                                                            @if (da.address_detail != null)
                                                            {
                                                                <span>@da.address_detail - </span>
                                                            }
                                                            @if (da.ward_id != null)
                                                            {
                                                                <span> @da.ward.Name - </span>
                                                            }
                                                            @if (da.district_id != null)
                                                            {
                                                                <span> @da.district.Name - </span>
                                                            }
                                                            @if (da.province_id != null)
                                                            {
                                                                <span> @da.province.Name</span>
                                                            }

                                                        </span>
                                                    </span>
                                                </a>
                                                <a class="dropdown-item disabled show_line_dropdown" href="javascript:void(0)"></a>
                                            }
                                        }
                                    </div>
                                </div>
                                <div class="line_div"></div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="control-label" for="modal_customer_first_name">Họ</label>
                                            <div class="mb-2">
                                                <input type="text" class="form-control" id="modal_customer_first_name" value="@ViewBag.DeliveryAddress.first_name" placeholder="Nhập họ của khách hàng">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="control-label" for="modal_customer_last_name">Tên</label>
                                            <div class="mb-2">
                                                <input type="text" class="form-control" id="modal_customer_last_name" value="@ViewBag.DeliveryAddress.last_name" placeholder="Nhập tên của khách hàng">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="control-label" for="modal_customer_phone_number">Điện thoại</label>
                                            <div class="mb-2">
                                                <input type="text" class="form-control inputmask" data-mask="(999) 999-9999" id="modal_customer_phone_number" value="@ViewBag.DeliveryAddress.phone_number" name="modal_customer_phone_number" placeholder="Nhập số điện thoại">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="control-label" for="modal_customer_address_detail">Địa chỉ</label>
                                            <div class="mb-2">
                                                <input class="form-control" type="text" id="modal_customer_address_detail" name="modal_customer_address_detail" value="@ViewBag.DeliveryAddress.address_detail" placeholder="Nhập địa chỉ khách hàng">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group bs-select-1">
                                            <label for="ddlCountry">Quốc gia</label>
                                            <select class="custom-select" id="modal_ddlCountry" style="border-radius: .25rem;" disabled>
                                                <option value="" selected="">Việt Nam </option>

                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group bs-select-1">
                                            <label for="ddlProvince">Tỉnh Thành</label>
                                            <select class="custom-select" id="modal_ddlProvince" style="border-radius: .25rem;">
                                                <option value="-1" selected>-- Chọn Tỉnh/Thành phố -- </option>
                                                @if (ViewBag.DeliveryAddress.province_id != null)
                                                {
                                                    foreach (var province in ViewData["ListProvince"] as List<province>)
                                                    {
                                                        if (province.Id == ViewBag.DeliveryAddress.province_id)
                                                        {
                                                            <option value="@province.Id" selected>@province.Type @province.Name</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="@province.Id">@province.Type @province.Name</option>
                                                        }
                                                    }
                                                }
                                                else
                                                {
                                                    foreach (var province in ViewData["ListProvince"] as List<province>)
                                                    {
                                                        <option value="@province.Id">@province.Type @province.Name</option>
                                                    }
                                                }
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group bs-select-1">
                                            <label for="ddlDistrict">Quận Huyện</label>
                                            <select class="custom-select" id="modal_ddlDistrict" style="border-radius: .25rem;">
                                                @if (ViewData["ListDistrictByProvince"] != null)
                                                {
                                                    foreach (var district in ViewData["ListDistrictByProvince"] as List<district>)
                                                    {
                                                        if (district.Id == ViewBag.DeliveryAddress.district_id)
                                                        {
                                                            <option value="@district.Id" selected>@district.Type @district.Name</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="@district.Id">@district.Type @district.Name</option>
                                                        }
                                                    }
                                                }
                                                else
                                                {
                                                    <option value="-1" selected>-- Chưa được chọn --</option>
                                                }
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group bs-select-1">
                                            <label for="ddlWard">Xã Phường / Thị trấn</label>
                                            <select class="custom-select" id="modal_ddlWard" style="border-radius: .25rem;">
                                                @if (ViewData["ListWardByDistrict"] != null)
                                                {
                                                    foreach (var ward in ViewData["ListWardByDistrict"] as List<ward>)
                                                    {
                                                        if (ward.Id == ViewBag.DeliveryAddress.ward_id)
                                                        {
                                                            <option value="@ward.Id" selected>@ward.Type @ward.Name</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="@ward.Id">@ward.Type @ward.Name</option>
                                                        }
                                                    }
                                                }
                                                else
                                                {
                                                    <option value="-1" selected>-- Chưa được chọn --</option>
                                                }
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="cancelModalConfirmDeliveryAddress()">Hủy</button>
                            <button type="button" class="btn btn-success" id="btn_confirm_delivery_address" onclick="confirmDeliveryAddress()">Xác nhận</button>
                        </div>
                    </div>
                </div>
            </div>
        }

        <div class="cardRightBottom">
            <div class="card mb-0 o-hidden">
                <div class="card-header">
                    <div class="card-heading">
                        <h4 class="card-title">Kênh bán hàng</h4>
                    </div>
                </div>
                <div class="card-body selects-contant-boots">
                    <form>
                        <div class="form-group bs-select-1">
                            <select class="custom-select" id="select_source_order" style="border-radius: .25rem;">
                                <option selected disabled>@ViewBag.SourceOrder</option>
                                <option>Draft</option>
                                <option>Facebook</option>
                                <option>Zalo</option>
                                <option>Website</option>
                                <option>Staff</option>
                                <option>App bán hàng</option>
                                <option>Điện thoại</option>
                                <option>Bán tại cửa hàng</option>
                                <option>Tiki</option>
                                <option>Shopee</option>
                                <option>Lazada</option>
                                <option>Sendo</option>
                                <option>Adayroi</option>
                            </select>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="line_div"></div>
<div class="row">
    <div class="col-12" style="margin-top: 15px;">
        <div class="pb-2" style="text-align:right">
            <a href="javascript:void(0)" class="btn btn-secondary" onclick="backHistory()">Hủy</a>
            <a href="javascript:void(0)" class="btn btn-primary" id="btn_update_draft_order" onclick="updateDraftOrder()">Lưu nháp</a>
        </div>
    </div>
</div>

<div class="modal fade hide in" data-keyboard="false" data-backdrop="static" id="modalAddPromotion" tabindex="-1" role="dialog" aria-labelledby="defaultModal" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    Thêm khuyễn mãi cho hóa đơn này
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label class="control-label" for="product_name">Giảm giá đơn hàng này theo</label>
                        <div class="row">
                            <div class="col-md-4 col-sm-12">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="promotion_type" id="money_value" value="money" checked>
                                    <label class="form-check-label" for="money_value">
                                        Tiền mặt (₫)
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-4 col-sm-12">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="promotion_type" id="percent_value" value="percent">
                                    <label class="form-check-label" for="percent_value">
                                        Phần trăm (%)
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-4 col-sm-12">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="promotion_type" id="promotion_code" value="code">
                                    <label class="form-check-label" for="promotion_code">
                                        Mã giảm giá
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="mb-2">
                            <input type="text" class="form-control" placeholder="Nhập số tiền khuyến mãi (không vượt quá tổng giá trị các sản phẩm trên hóa đơn)" id="promotion_value_input">
                            <div class="invalid-feedback" id="promotion_value_input_feedback">
                                Yêu cầu nhập giá trị khuyến mãi.
                            </div>
                            <div class="invalid-feedback" id="promotion_percent_input_feedback">
                                Phần trăm khuyến mãi nằm trong khoảng từ <strong>1%</strong> đến <strong>100%</strong>.
                            </div>
                            <div class="invalid-feedback" id="promotion_code_input_feedback">

                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label" for="product_name">Lý do khuyến mãi</label>
                        <div class="mb-2">
                            <input type="text" class="form-control" id="promotion_reason_input" placeholder="VD: Đơn hàng VIP, Khách hàng quen,...">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="cancelPromotionModal()">Hủy</button>
                <button type="button" class="btn btn-success" onclick="confirmBtnPromotion()">Xác nhận khuyến mãi</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade hide in" data-keyboard="false" data-backdrop="static" id="modalAddShippingPrice" tabindex="-1" role="dialog" aria-labelledby="defaultModal" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    Thêm phí vận chuyển cho đơn hàng này
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label class="control-label">Lựa chọn hình thức vận chuyển</label>
                        <div class="" id="div_note_suggest_add_customer_info">
                            <div class="alert alert-icon alert-outline-info" role="alert">
                                <i class="fa fa-info-circle"></i> Hãy thêm thông tin khách hàng với <strong>địa chỉ giao hàng đầy đủ</strong> để thấy các mức phí vận chuyển theo khu vực đã cấu hình. <br />
                                <i class="fa fa-hand-o-right"></i> <a href="javascript:void(0)" class="text-info font-bold" onclick="moveToCustomerInfoCard()">Click ngay để tới mục thông tin khách hàng</a>
                            </div>
                        </div>
                        <div id="div_radio_btn_local_shipping_service">
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="shipping_type" id="free_ship" value="free_ship" checked>
                            <label class="form-check-label" for="free_ship">
                                Miễn phí vận chuyển (Free Ship)
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="shipping_type" id="other_ship" value="other_ship">
                            <label class="form-check-label" for="other_ship">
                                Tùy chỉnh phí vận chuyển khác
                            </label>
                        </div>
                    </div>
                    <div class="form-group" id="div_other_shipping" style="display: none">
                        <div class=" row">
                            <div class="col-md-8">
                                <div class="mb-2">
                                    <input type="text" class="form-control" placeholder="Nhập tên dịch vụ vận chuyển" id="name_of_other_ship">
                                    <div class="invalid-feedback" id="name_of_other_ship_feedback">
                                        Yêu cầu nhập tên dịch vụ vận chuyển.
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-2">
                                    <input type="text" class="form-control autoNumericInput" id="price_of_other_ship">
                                    <div class="invalid-feedback" id="price_of_other_ship_feedback">
                                        Yêu cầu nhập giá dịch vụ vận chuyển.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-success" onclick="confirmBtnShippingPrice()">Xác nhận phí vận chuyển</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade hide in" data-keyboard="false" data-backdrop="static" id="modalSelectCustomer" tabindex="-1" role="dialog" aria-labelledby="defaultModal" aria-hidden="true">
    <div class="modal-dialog modalBigDialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    Lựa chọn khách hàng cho đơn hàng này
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="tab nav-border-bottom" style="width:100%; padding: 10px 15px;" id="tab_list_customer">
                        <ul class="nav nav-tabs" role="tablist">
                            <li class="nav-item li_tab_list_customer_to_select">
                                <a class="nav-link show active" id="tab_all_customer" data-toggle="tab" href="#all_customer" role="tab" aria-controls="all_customer" aria-selected="true">
                                    <i class="fa fa-list-ul"></i> Tất cả khách hàng
                                </a>
                            </li>
                            <li class="nav-item li_tab_list_customer_to_select">
                                <a class="nav-link show" id="tab_marketing_customer" data-toggle="tab" href="#marketing_customer" role="tab" aria-controls="marketing_customer" aria-selected="false">
                                    <i class="fa fa-envelope"></i> Nhận email quảng cáo
                                </a>
                            </li>
                            <li class="nav-item li_tab_list_customer_to_select">
                                <a class="nav-link show" id="tab_close_customer" data-toggle="tab" href="#close_customer" role="tab" aria-controls="close_customer" aria-selected="false">
                                    <i class="fa fa-shopping-bag"></i> Khách hàng thân thiết
                                </a>
                            </li>
                            <li class="nav-item li_tab_list_customer_to_select">
                                <a class="nav-link show" id="tab_potential_customer" data-toggle="tab" href="#potential_customer" role="tab" aria-controls="potential_customer" aria-selected="false">
                                    <i class="fa fa-shopping-basket"></i> Khách hàng tiềm năng
                                </a>
                            </li>
                            <li class="nav-item li_tab_list_customer_to_select">
                                <a class="nav-link show" id="tab_customer_has_caneled_order" data-toggle="tab" href="#customer_has_caneled_order" role="tab" aria-controls="customer_has_caneled_order" aria-selected="false">
                                    <i class="fa fa-times-rectangle-o"></i> Có đơn hàng đã hủy
                                </a>
                            </li>
                            <li class="nav-item li_tab_list_customer_to_select">
                                <a class="nav-link show" id="tab_customer_has_caneled_order" data-toggle="tab" href="#customer_has_caneled_order" role="tab" aria-controls="customer_has_caneled_order" aria-selected="false">
                                    <i class="fa fa-user-times"></i> Thuộc danh sách đen
                                </a>
                            </li>
                        </ul>
                        <div class="tab-content">
                            <div class="div_list_in_tab">
                                <div class="row">
                                    <div class="col-md-9">
                                        <div class="input-group mb-3">
                                            <form id="form_filter">
                                                <div class="btn-group">
                                                    <select class="custom-select" id="select_filter">
                                                        <option value="all" selected="">Lọc khách hàng theo</option>
                                                        <option value="money_purchased">Số tiền đã mua</option>
                                                        <option value="number_of_order">Đơn hàng</option>
                                                        <option value="time_to_order">Thời điểm đặt hàng</option>
                                                        <option value="customer_tag">Thẻ tag</option>
                                                        <option value="customer_address">Địa chỉ/Khu vực</option>
                                                        <option value="customer_month_of_birth">Sinh nhật</option>
                                                    </select>

                                                    <select class="custom-select" id="select_condition_filter" style="display: none">
                                                        <option selected="" value="-1" disabled>Chọn điều kiện lọc...</option>
                                                    </select>

                                                    <input type="text" class="form-control input_no_border_radius" value="0" id="value_select_condition" name="value_select_condition" style="display: none">
                                                </div>
                                            </form>

                                            <input type="text" class="form-control" id="search_input_customer" name="search_input_customer" value="@ViewBag.FilterValue" placeholder="Tìm kiếm khách hàng theo tên..." aria-describedby="button-addon2">
                                            <div class="input-group-append">
                                                <button class="btn btn-primary" type="button" id="btn_search" onclick="searchCustomer()">
                                                    <i class="nav-icon ti ti-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3" style="text-align:right">
                                        <form id="set_condition_show">
                                            <div class="btn-group">
                                                <select class="custom-select" id="sort_list_return_select">
                                                    <option selected="" value="name_az" disabled>Sắp xếp thứ tự theo</option>
                                                    <option value="name_az">Tên khách hàng: A -> Z</option>
                                                    <option value="name_za">Tên khách hàng: Z -> A</option>
                                                    <option disabled>------------------------------------------</option>
                                                    <option value="count_order_asc">Lượng đơn hàng: Tăng</option>
                                                    <option value="count_order_dec">Lượng đơn hàng: Giảm</option>
                                                </select>
                                            </div>
                                            <div class="btn-group">
                                                <select class="custom-select" id="size_of_page_select">
                                                    <option selected="" value="10" disabled>Hiển thị</option>
                                                    <option value="5">5</option>
                                                    <option value="10">10</option>
                                                    <option value="20">20</option>
                                                    <option value="50">50</option>
                                                </select>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div id="data_table">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy Và Quay Lại</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade hide in" data-keyboard="false" data-backdrop="static" id="modalCreateNewCustomer" tabindex="-1" role="dialog" aria-labelledby="defaultModal" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    Tạo thông tin khách hàng
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="control-label" for="modal_create_customer_first_name">Họ</label>
                                <div class="mb-2">
                                    <input type="text" class="form-control" id="modal_create_customer_first_name" placeholder="Nhập họ của khách hàng">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="control-label" for="modal_create_customer_last_name">Tên</label>
                                <div class="mb-2">
                                    <input type="text" class="form-control" id="modal_create_customer_last_name" placeholder="Nhập tên của khách hàng">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label" for="modal_create_customer_email">Email</label>
                        <div class="mb-2">
                            <input type="text" class="form-control" id="modal_create_customer_email" name="modal_create_customer_email" placeholder="Nhập email">
                            <div class="invalid-feedback" id="modal_create_customer_email_feedback">

                            </div>
                        </div>
                    </div>
                    <div class="form-group form-check">
                        <input type="checkbox" class="form-check-input" id="modal_create_status_marketing" value="true">
                        <label class="form-check-label font-bold" for="modal_create_status_marketing">
                            Đồng ý nhận email tiếp thị
                        </label>
                    </div>
                    <div class="line_div"></div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="control-label" for="modal_create_customer_phone_number">Điện thoại</label>
                                <div class="mb-2">
                                    <input onchange="checkDupplicatePhoneNumber()" type="text" class="form-control inputmask" data-mask="(999) 999-9999" id="modal_create_customer_phone_number" name="modal_create_customer_phone_number" placeholder="Nhập số điện thoại">
                                    <div class="invalid-feedback" id="modal_create_customer_phone_number_feedback">

                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="control-label" for="modal_create_customer_address_detail">Địa chỉ</label>
                                <div class="mb-2">
                                    <input class="form-control" type="text" id="modal_create_customer_address_detail" name="modal_create_customer_address_detail" placeholder="Nhập địa chỉ khách hàng">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group bs-select-1">
                                <label for="modal_create_ddlCountry">Quốc gia</label>
                                <select class="custom-select" id="modal_create_ddlCountry" style="border-radius: .25rem;" disabled>
                                    <option value="" selected="">Việt Nam </option>

                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group bs-select-1">
                                <label for="modal_create_ddlProvince">Tỉnh Thành</label>
                                <select class="custom-select" id="modal_create_ddlProvince" style="border-radius: .25rem;">
                                    <option value="-1" selected>-- Chọn Tỉnh/Thành phố -- </option>
                                    @foreach (var province in ViewData["ListProvince"] as List<province>)
                                    {
                                        <option value="@province.Id">@province.Type @province.Name</option>
                                    }
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group bs-select-1">
                                <label for="modal_create_ddlDistrict">Quận Huyện</label>
                                <select class="custom-select" id="modal_create_ddlDistrict" style="border-radius: .25rem;">
                                    <option value="-1" selected>-- Chưa được chọn --</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group bs-select-1">
                                <label for="modal_create_ddlWard">Xã Phường / Thị trấn</label>
                                <select class="custom-select" id="modal_create_ddlWard" style="border-radius: .25rem;">
                                    <option value="-1">-- Chưa được chọn -- </option>
                                </select>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="cancelCreateCustomer()">Hủy</button>
                <button type="button" class="btn btn-success" id="btn_confirm_create_customer" onclick="createCustomer()">Xác nhận</button>
            </div>
        </div>
    </div>
</div>



<div class="modal fade hide in" data-keyboard="false" data-backdrop="static" id="modalEditEmail" tabindex="-1" role="dialog" aria-labelledby="defaultModal" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    Cập nhật Email
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label class="control-label" for="modal_edit_customer_email">Email</label>
                        <div class="mb-2">
                            <input type="text" class="form-control" id="modal_edit_customer_email" name="modal_edit_customer_email" value="@ViewBag.Customer.customer_email" placeholder="Nhập email">
                            <div class="invalid-feedback" id="modal_edit_customer_email_feedback">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-success" id="btn_confirm_edit_email" onclick="confirmEditEmail()">Xác nhận</button>
            </div>
        </div>
    </div>
</div>


@*XÁC NHẬN THANH TOÁN*@
<div class="modal fade hide in" data-keyboard="false" data-backdrop="static" id="modalConfirmIsPaid" tabindex="-1" role="dialog" aria-labelledby="defaultModal" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    Tạo đơn hàng mới
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <label> Xác nhận đã thanh toán cho đơn hàng này?</label><br />
                <div>
                    <a>
                        Trạng thái thanh toán của đơn hàng là <strong>Đã thanh toán.</strong><br />
                        Sau khi đơn hàng đã tạo, bạn không thể thay đổi phương thức hoặc trạng thái thanh toán.
                    </a>
                </div><br />
                <form>
                    <div class="form-group bs-select-1">
                        <label>
                            Chọn phương thức thanh toán cho đơn hàng này
                        </label>
                        <select class="custom-select" id="modal_confirm_payment" style="border-radius: .25rem;">
                            <option value="3" selected>Thanh toán khi giao hàng (COD)</option>
                            <option value="4">Chuyển khoản qua ngân hàng</option>
                        </select>
                    </div>
                </form>
                <div>
                    <a class="text-info font-bold">Số tiền đã nhận : <span class="text-danger showNumeric" id="amount_received"></span></a>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-success" onclick="makeOrderPaid()">Tạo đơn hàng</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade hide in" data-keyboard="false" data-backdrop="static" id="modalConfirmIsPending" tabindex="-1" role="dialog" aria-labelledby="defaultModal" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    Tạo đơn hàng mới
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <label>
                    Xác nhận sẽ nhận thanh toán sau cho đơn hàng này?
                </label><br />
                <div>
                    <a>
                        Trạng thái thanh toán của đơn hàng là <strong>Chờ xử lý.</strong><br />
                        Sau khi đơn hàng đã tạo, bạn không thể thay đổi phương thức hoặc trạng thái thanh toán.
                    </a>
                </div><br />
                <form>
                    <div class="form-group bs-select-1">
                        <label>
                            Chọn phương thức thanh toán cho đơn hàng này
                        </label>
                        <select class="custom-select" id="modal_confirm_payment" style="border-radius: .25rem;">
                            <option value="3" selected>Thanh toán khi giao hàng (COD)</option>
                            <option value="4">Chuyển khoản qua ngân hàng</option>
                        </select>
                    </div>
                </form>
                <div>
                    <a class="text-info font-bold">Chờ thanh toán : <span class="text-danger showNumeric" id="amount_pending"></span></a>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-success" onclick="makeOrderPaid()">Tạo đơn hàng</button>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#order').addClass('active');
        $('#draft_order').addClass('active');

        if (Cookies.get("insert_draft_order_success") != null) {
            showToast("success", 'Đơn hàng nháp <strong>#' + Cookies.get('insert_draft_order_success') + '</strong> đã được tạo.', "Tạo thành công");
            Cookies.remove('insert_draft_order_success');
        }

        $(".autoNumericInput").autoNumeric('init', { aSign: ' ₫', pSign: 's', mDec: '0', aSep: '.', aDec: ',' });
        $(".showNumeric").autoNumeric('init', { aSign: ' ₫', pSign: 's', mDec: '0', aSep: '.', aDec: ',' });
        $(".quantity_input").autoNumeric('init', { aSign: '', pSign: 's', mDec: '0', aSep: '.', aDec: ',' });
        $('form').trigger('reset');

        $("#promotion_value_input").autoNumeric('init', { aSign: ' ₫', pSign: 's', mDec: '0', aSep: '.', aDec: ',' });

        $('#sum_in_all_product').autoNumeric('set', 0);
        $('#promotion_value').autoNumeric('set', 0);
        $('#ship_price').autoNumeric('set', 0);
        $('#total_in_order').autoNumeric('set', 0);
        $('#price_of_other_ship').autoNumeric('set', 0);

        //$('form').dirrty({
        //    preventLeaving: true
        //}).on("dirty", function () {
        //    //$("#btn_insert").removeClass("disabled");
        //}).on("clean", function () {
        //    //$("#btn_insert").addClass("disabled");
        //});

        if (@Model.customer_id != null) {
            customer_id_selected = @Model.customer_id;
        }

        if (@ViewBag.DeliveryAddress.delivery_address_id != null) {
            delivery_address_id_selected = @ViewBag.DeliveryAddress.delivery_address_id;
        }

        //Lấy hết product cho order
        var order_id_to_get_all_of_product = @Model.order_id;
        $.ajax({
            url: "/Order/GetAllOfProductInOrder",
            data: {
                order_id: order_id_to_get_all_of_product
            },
            context: document.body,
            type: "POST",
            dataType: "html",
            success: function (data) {
                data_json = JSON.parse(data);

                //product variation
                if (data_json.list_product_variation_in_order.length > 0) {
                    $.each(data_json.list_product_variation_in_order, function (i, value) {
                        var index = value.product_variation_id;
                        list_product_variation_id.push(index);
                        var img_src = value.product_variation_image;
                        var product_name = value.product_name;
                        var product_variation_name = value.product_variation_name;
                        var product_unit = value.unit_name;
                        var product_price = value.product_variation_price;
                        var initialization_quantity = value.product_variation_quantity;

                        new_product_index++;
                        list_new_product_index.push(new_product_index);
                        $('#btn_is_paid').removeClass('disabled');
                        $('#btn_is_pending').removeClass('disabled');
                        $('#div_list_product_selected').css({ display: 'block' });

                        $('#table_list_product_selected').append('<tr id="tr_product_in_order_' + new_product_index + '" class="tr_product_in_order_class_' + index + '"><td scope="row" id="' + new_product_index + '" class="td_img_' + index + '"><img src="' + img_src + '" class="img-fluid bg-img img_product_in_order"/>&nbsp;</td><td style="white-space: unset" id="new_product_name_' + new_product_index + '">' + product_name + '<br/><small class="text-info">' + product_variation_name + '</small></td><td id="new_product_price_' + new_product_index + '" class="showNumeric">' + product_price + '</td><td><p></p><div class="input-group" style="width: 80%"><span class="input-group-btn"><button type="button" class="btn btn-primary disabled btn-number btn-number_' + new_product_index + '" data-type="minus" data-field="quant[' + new_product_index + ']" id="btn_minius_' + new_product_index + '"><span class="fa fa-minus"></span></button></span><input id="id_input_quantity_' + index + '" readonly type="text" name="quant[' + new_product_index + ']" class="form-control input-number input-number_' + new_product_index + ' class_input_quantity_' + index + '" value="' + initialization_quantity + '" min="1" max="10000"><span class="input-group-btn"><button type="button" class="btn btn-primary btn-number btn-number_' + new_product_index + '" data-type="plus" data-field="quant[' + new_product_index + ']" id="btn_plus_' + new_product_index + '"><span class="fa fa-plus"></span></button></span></div><p></p></td><td id="' + index + '" class="unit_' + new_product_index + '">(<span id="product_variation_unit_name_' + index + '">' + product_unit + '</span>)</td><td class="showNumeric sum_in_1_product" id="sum_in_a_product_' + new_product_index + '">' + (product_price * initialization_quantity) + '</td><td><a id="' + index + '" class="tooltip-wrapper text-primary remove_product_in_order_' + new_product_index + '" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Xóa sản phẩm này khỏi đơn hàng" href="javascript:void(0)"><i class="fa fa-remove"></i></a></td></tr>');
                        inputQuantity(new_product_index);

                        if (initialization_quantity > 1) {
                            $('.btn-number_' + new_product_index).removeClass('disabled');
                        }
                    });
                    $.each(list_new_product_index, function (index, value) {
                        var index_by_id_product = $('.unit_' + value).attr('id');
                        $("#Check_" + index_by_id_product).prop('checked', true);
                    });

                    $(".showNumeric").autoNumeric('init', { aSign: ' ₫', pSign: 's', mDec: '0', aSep: '.', aDec: ',' });
                    $(".quantity_input").autoNumeric('init', { aSign: '', pSign: 's', mDec: '0', aSep: '.', aDec: ',' });
                    resolveCostOrder();

                    $.each(list_new_product_index, function (index, value) {
                        //Has changed about cost
                        $('.input-number_' + value).on('change', function () {
                            var cost_of_1_product = $(this).val() * $('#new_product_price_' + value).autoNumeric('get');
                            $('#sum_in_a_product_' + value).autoNumeric('set', cost_of_1_product);
                            resolveCostOrder();
                        });
                    });

                    $.each(list_new_product_index, function (index, value) {
                        //Remove
                        $('.remove_product_in_order_' + value).click(function () {
                            var id_to_uncheck = $('.unit_' + value).attr('id');
                            var product_variation_id_to_remove = $('.remove_product_in_order_' + value).attr('id');
                            $("#Check_" + id_to_uncheck).prop('checked', false);
                            list_new_product_index = list_new_product_index.filter(function (elem) {
                                return elem != value;
                            });

                            list_product_variation_id = list_product_variation_id.filter(function (elem) {
                                return elem != product_variation_id_to_remove;
                            });

                            $('#tr_product_in_order_' + value).remove();
                            if (list_new_product_index.length == 0) {
                                $('#btn_is_paid').addClass('disabled');
                                $('#btn_is_pending').addClass('disabled');
                                $('#div_list_product_selected').css({ display: 'none' });
                                $('#text_reason_promotion').css({ display: 'none' });
                                //$('#text_name_of_shipping').css({ display: 'none' });
                                //$('#ship_price').autoNumeric('set', 0);
                                $('#promotion_value').autoNumeric('set', 0);
                            }
                            resolveCostOrder();
                        });
                    });
                }

                //Custom Product
                if (data_json.list_custom_product_in_order.length > 0) {
                    $.each(data_json.list_custom_product_in_order, function (i, value) {
                        var new_product_name = value.custom_product_in_order_name;
                        var new_product_price = value.custom_product_in_order_price;
                        var new_product_quantity = value.custom_product_in_order_quantity;
                        var new_product_unit_name = value.unit_name;

                        new_product_index++;
                        custom_product_id++;
                        list_new_product_index.push(new_product_index);
                        list_custom_product_id.push(custom_product_id);
                        $('#btn_is_paid').removeClass('disabled');
                        $('#btn_is_pending').removeClass('disabled');

                        $('#new_product_quantity_feedback,#new_product_name_feedback,#new_product_price_input_feedback').each(function () {
                            $(this).css({ display: 'none' });
                        });
                        $('#new_product_quantity,#new_product_name,#new_product_price_input').each(function () {
                            $(this).removeClass('is-invalid');
                        });
                        //Show div list product selected
                        $('#div_list_product_selected').css({ display: 'block' });
                        //Reset form add new product
                        $('form#form_add_new_product_for_order').trigger('reset');
                        //Append new product to div list
                        $('#table_list_product_selected').append('<tr id="tr_product_in_order_' + new_product_index + '"><td scope="row"><img src="../Assets/images/Icon/iconImg.png" class="img-fluid bg-img img_product_in_order" style="background-color: #ccc"/>&nbsp;</td><td class="custom_product_name_' + custom_product_id + '" id="new_product_name_' + new_product_index + '">' + new_product_name + '</td><td id="new_product_price_' + new_product_index + '" class="showNumeric custom_product_price_' + custom_product_id + '">' + new_product_price + '</td><td><p></p><div class="input-group" style="width: 80%"><span class="input-group-btn"><button type="button" class="btn btn-primary disabled btn-number btn-number_' + new_product_index + '" data-type="minus" data-field="quant[' + new_product_index + ']" id="btn_minius_' + new_product_index + '"><span class="fa fa-minus"></span></button></span><input readonly type="text" name="quant[' + new_product_index + ']" class="form-control custom_product_quantity_' + custom_product_id + ' input-number input-number_' + new_product_index + '" value="' + new_product_quantity + '" min="1" max="10000"><span class="input-group-btn"><button type="button" class="btn btn-primary btn-number btn-number_' + new_product_index + '" data-type="plus" data-field="quant[' + new_product_index + ']" id="btn_plus_' + new_product_index + '"><span class="fa fa-plus"></span></button></span></div><p></p></td><td>(<span class="custom_product_unit_name_' + custom_product_id + '">' + new_product_unit_name + '</span>)</td><td class="showNumeric sum_in_1_product" id="sum_in_a_product_' + new_product_index + '">' + (new_product_price * new_product_quantity) + '</td><td><a id="remove_product_in_order_' + new_product_index + '" class="tooltip-wrapper text-primary remove_product_in_order_' + new_product_index + '" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Xóa sản phẩm này khỏi đơn hàng" href="javascript:void(0)"><i class="fa fa-remove class_icon_remove_' + new_product_index + '" id="id_icon_remove_' + custom_product_id + '"></i></a></td></tr>');
                        //$('#new_product_name_' + new_product_index).css({whiteSpace: 'unset'});
                        if (new_product_price > 1) {
                            $('#btn_minius_' + new_product_index).removeClass('disabled');
                        }
                        $(".showNumeric").autoNumeric('init', { aSign: ' ₫', pSign: 's', mDec: '0', aSep: '.', aDec: ',' });
                        $(".quantity_input").autoNumeric('init', { aSign: '', pSign: 's', mDec: '0', aSep: '.', aDec: ',' });
                        inputQuantity(new_product_index);
                    });
                    resolveCostOrder();

                    $.each(list_new_product_index, function (index, value) {
                        //Has changed about cost
                        $('.input-number_' + value).on('change', function () {
                            var cost_of_1_product = $(this).val() * $('#new_product_price_' + value).autoNumeric('get');
                            $('#sum_in_a_product_' + value).autoNumeric('set', cost_of_1_product);
                            resolveCostOrder();
                        });
                    });

                    $.each(list_new_product_index, function (index, value) {
                        //Remove
                        $('.remove_product_in_order_' + value).click(function () {
                            list_new_product_index = list_new_product_index.filter(function (elem) {
                                return elem != value;
                            });
                            var cp_id_to_remove = $('.class_icon_remove_' + value).attr('id').match(/\d/g);
                            list_custom_product_id = list_custom_product_id.filter(function (elem) {
                                return elem != cp_id_to_remove;
                            });
                            console.log(list_custom_product_id);
                            $('#tr_product_in_order_' + value).remove();
                            if (list_new_product_index.length == 0) {
                                $('#btn_is_paid').addClass('disabled');
                                $('#btn_is_pending').addClass('disabled');
                                $('#div_list_product_selected').css({ display: 'none' });
                                $('#text_reason_promotion').css({ display: 'none' });
                                //$('#text_name_of_shipping').css({ display: 'none' });
                                //$('#ship_price').autoNumeric('set', 0);
                                $('#promotion_value').autoNumeric('set', 0);
                            }
                            resolveCostOrder();
                        });
                    });
                }

                if (data_json.discount_amount != null) {
                    $('#label_small_reason_promotion').css({ display: 'block' });
                    $('#text_reason_promotion').text(data_json.reason_of_promotion);
                    $('#promotion_value_action').text(" Sửa");
                    $('#promotion_value').autoNumeric('set', data_json.discount_amount);
                    resolveCostOrder();
                }

                if (data_json.cost_of_shipping != null) {
                    $('#label_small_name_of_shipping').css({ display: 'block' });
                    $('#text_name_of_shipping').text(data_json.name_of_shipping);
                    $('#shipping_price_action').text(" Sửa");
                    $('#ship_price').autoNumeric('set', data_json.cost_of_shipping);
                    resolveCostOrder();
                }
            },
            error: function (xhr, status) {
                showToast("error", "Có lỗi khi tìm kiếm sản phẩm.", "Lỗi");
            },
        });

        //// truyền id của district vào
        $("#modal_create_ddlProvince").on('change', function () {
            var id = $(this).val();
            $.ajax({
                type: "GET",
                data: { id: id },
                url: '@Url.Action("GetAllDistrictByProvinceId", "GetLocal")',
                success: function (data) {
                    $("#modal_create_ddlDistrict").empty();
                    $("#modal_create_ddlWard").empty();
                    $("#modal_create_ddlDistrict").append('<option value="-1">-- Chọn Quận/Huyện --</option>');
                    $("#modal_create_ddlWard").append('<option value="-1">-- Chọn Phường/Xã --</option>');
                    $.each(data, function (key, value) {
                        $("#modal_create_ddlDistrict").append('<option value="' + value.district_id + '"> ' + value.district_type + " " + value.district_name + '</option>');
                    });
                },
                error: function (xhr) {
                    toastExportError();
                }
            });
        });

        $("#modal_create_ddlDistrict").on('change', function () {
            var id = $(this).val();
            $.ajax({
                type: "GET",
                data: { id: id },
                url: '@Url.Action("GetAllWardByDistrictId", "GetLocal")',
                success: function (data) {
                    $("#modal_create_ddlWard").empty();
                    $("#modal_create_ddlWard").append('<option value="-1">-- Chọn Phường/Xã --</option>');
                    $.each(data, function (key, value) {
                        $("#modal_create_ddlWard").append('<option value="' + value.ward_id + '"> ' + value.ward_type + " " + value.ward_name + '</option>');
                    });
                },
                error: function (xhr) {
                    toastExportError();
                }
            });
        });

        //// truyền id của district vào
        $("#modal_ddlProvince").on('change', function () {
            var id = $(this).val();
            $.ajax({
                type: "GET",
                data: { id: id },
                url: '@Url.Action("GetAllDistrictByProvinceId", "GetLocal")',
                success: function (data) {
                    $("#modal_ddlDistrict").empty();
                    $("#modal_ddlWard").empty();
                    $("#modal_ddlDistrict").append('<option value="-1">-- Chọn Quận/Huyện --</option>');
                    $("#modal_ddlWard").append('<option value="-1">-- Chọn Phường/Xã --</option>');
                    $.each(data, function (key, value) {
                        $("#modal_ddlDistrict").append('<option value="' + value.district_id + '"> ' + value.district_type + " " + value.district_name + '</option>');
                    });
                },
                error: function (xhr) {
                    toastExportError();
                }
            });
        });

        $("#modal_ddlDistrict").on('change', function () {
            var id = $(this).val();
            $.ajax({
                type: "GET",
                data: { id: id },
                url: '@Url.Action("GetAllWardByDistrictId", "GetLocal")',
                success: function (data) {
                    $("#modal_ddlWard").empty();
                    $("#modal_ddlWard").append('<option value="-1">-- Chọn Phường/Xã --</option>');
                    $.each(data, function (key, value) {
                        $("#modal_ddlWard").append('<option value="' + value.ward_id + '"> ' + value.ward_type + " " + value.ward_name + '</option>');
                    });
                },
                error: function (xhr) {
                    toastExportError();
                }
            });
        });

        //Tab List Customer
        tabFilter();

    });



    $('#select-filter').on('change', function () {
        var filter_value_parent = this.value;
        var search_string = $('#search_input').val().trim();
        if (filter_value_parent == "product_status") {
            $('#filter-by-product-status').css('display', 'block');
            $('#filter-by-category').css('display', 'none');
            $('#filter-by-supplier').css('display', 'none');
        }
        else if (filter_value_parent == "category") {
            $('#filter-by-product-status').css('display', 'none');
            $('#filter-by-category').css('display', 'block');
            $('#filter-by-supplier').css('display', 'none');
        }
        else if (filter_value_parent == "supplier") {
            $('#filter-by-product-status').css('display', 'none');
            $('#filter-by-category').css('display', 'none');
            $('#filter-by-supplier').css('display', 'block');
        }
        else {
            $('#form_filter.custom-select').trigger("reset");
            $('#filter-by-product-status').css('display', 'none');
            $('#filter-by-supplier').css('display', 'none');
            $('#filter-by-category').css('display', 'none');
            string_value_to_filter = "";
            $.ajax({
                url: "/Product/IndexProductNotAction",
                data: {
                    search_string: search_string,
                    page_num: 1,
                },
                context: document.body,
                type: "GET",
                dataType: "html",
                success: function (data) {
                    $("#data_table_not_action").html($(data).find("#data_table_not_action"));
                },
                error: function (xhr, status) {
                },
                complete: function (xhr, status) {
                    //$('#showresults').slideDown('slow')
                }
            });

        }
    });

    function resetForm() {
        $('form#form_add_new_product_for_order').trigger('reset');
    }

    function resolveCostOrder() {
        var sum_in_all_product = 0;
        var total_in_order = 0;
        var promotion_radio_value = $('input:radio[name="promotion_type"]:checked').val();

        if (promotion_radio_value == 'percent') {
            $('.sum_in_1_product').each(function () {
                sum_in_all_product += (parseInt)($(this).autoNumeric('get'));
            });
            $('#sum_in_all_product').autoNumeric('set', sum_in_all_product);

            var promotion_value = $('#promotion_value_input').autoNumeric('get');
            var ship_price = $('#ship_price').autoNumeric('get');
            var promotion_value_pass_to_money = ((parseInt)(sum_in_all_product)) * (promotion_value / 100);
            $('#promotion_value').autoNumeric('set', promotion_value_pass_to_money);

            total_in_order = sum_in_all_product + (parseInt)($('#ship_price').autoNumeric('get')) - promotion_value_pass_to_money;
            $('#total_in_order').autoNumeric('set', total_in_order);
        }
        else {
            $('.sum_in_1_product').each(function () {
                sum_in_all_product += (parseInt)($(this).autoNumeric('get'));
                total_in_order = sum_in_all_product + (parseInt)($('#ship_price').autoNumeric('get')) - (parseInt)($('#promotion_value').autoNumeric('get'));
            });
            $('#sum_in_all_product').autoNumeric('set', sum_in_all_product);
            $('#total_in_order').autoNumeric('set', total_in_order);
        }

    }

    function checkCostHasChangeToChangePercentValue() {
        var promotion_radio_value = $('input:radio[name="promotion_type"]:checked').val();
        if (promotion_radio_value == 'percent') {
            var promotion_value = $('#promotion_value_input').autoNumeric('get');
            var total_cost_product_in_order = $('#total_in_order').autoNumeric('get');
            var sum_in_all_product = $('#sum_in_all_product').autoNumeric('get');
            var ship_price = $('#ship_price').autoNumeric('get');

            var promotion_value_pass_to_money = ((parseInt)(sum_in_all_product)) * (promotion_value / 100);
            $('#promotion_value').autoNumeric('set', promotion_value_pass_to_money);
            //resolveCostOrder();
        }
    }

    var list_product_variation_id = [];
    var new_product_index = 0;
    var list_new_product_index = [];
    var list_product_in_order = [];
    var custom_product_id = 0;
    var list_custom_product_id = [];
    function addNewProductForOrder() {
        var new_product_name = $('#new_product_name').val().trim();
        var new_product_price = $("#new_product_price_input").autoNumeric('get');
        var new_product_quantity = $("#new_product_quantity").autoNumeric('get');
        var new_product_unit_name = $("#new_product_unit_id option:selected").text();
        var new_product_unit_id = $("#new_product_unit_id").val();

        if (new_product_name == null || new_product_name == "") {
            $('#new_product_name_feedback').css({ display: 'block' });
            $('#new_product_name').addClass('is-invalid');

            $('#new_product_price_input').removeClass('is-invalid');
            $('#new_product_price_input_feedback').css({ display: 'none' });
            $('#new_product_quantity').removeClass('is-invalid');
            $('#new_product_quantity_feedback').css({ display: 'none' });
        }
        else if (new_product_price == null || new_product_price == "") {
            $('#new_product_price_input_feedback').css({ display: 'block' });
            $('#new_product_price_input').addClass('is-invalid');

            $('#new_product_name').removeClass('is-invalid');
            $('#new_product_name_feedback').css({ display: 'none' });
            $('#new_product_quantity').removeClass('is-invalid');
            $('#new_product_quantity_feedback').css({ display: 'none' });
        }
        else if (new_product_quantity < 1 || new_product_quantity == "" || new_product_quantity == null || new_product_quantity > 9999) {
            $('#new_product_quantity_feedback').css({ display: 'block' });
            $('#new_product_quantity').addClass('is-invalid');

            $('#new_product_price_input').removeClass('is-invalid');
            $('#new_product_price_input_feedback').css({ display: 'none' });
            $('#new_product_name').removeClass('is-invalid');
            $('#new_product_name_feedback').css({ display: 'none' });
        }
        else {
            new_product_index++;
            custom_product_id++;
            list_new_product_index.push(new_product_index);
            list_custom_product_id.push(custom_product_id);
            $('#btn_is_paid').removeClass('disabled');
            $('#btn_is_pending').removeClass('disabled');

            $('#new_product_quantity_feedback,#new_product_name_feedback,#new_product_price_input_feedback').each(function () {
                $(this).css({ display: 'none' });
            });
            $('#new_product_quantity,#new_product_name,#new_product_price_input').each(function () {
                $(this).removeClass('is-invalid');
            });
            //Show div list product selected
            $('#div_list_product_selected').css({ display: 'block' });
            //Reset form add new product
            $('form#form_add_new_product_for_order').trigger('reset');
            //Append new product to div list
            $('#table_list_product_selected').append('<tr id="tr_product_in_order_' + new_product_index + '"><td scope="row"><img src="../Assets/images/Icon/iconImg.png" class="img-fluid bg-img img_product_in_order" style="background-color: #ccc"/>&nbsp;</td><td class="custom_product_name_' + custom_product_id + '" id="new_product_name_' + new_product_index + '">' + new_product_name + '</td><td id="new_product_price_' + new_product_index + '" class="showNumeric custom_product_price_' + custom_product_id + '">' + new_product_price + '</td><td><p></p><div class="input-group" style="width: 80%"><span class="input-group-btn"><button type="button" class="btn btn-primary disabled btn-number btn-number_' + new_product_index + '" data-type="minus" data-field="quant[' + new_product_index + ']" id="btn_minius_' + new_product_index + '"><span class="fa fa-minus"></span></button></span><input readonly type="text" name="quant[' + new_product_index + ']" class="form-control custom_product_quantity_' + custom_product_id + ' input-number input-number_' + new_product_index + '" value="' + new_product_quantity + '" min="1" max="10000"><span class="input-group-btn"><button type="button" class="btn btn-primary btn-number btn-number_' + new_product_index + '" data-type="plus" data-field="quant[' + new_product_index + ']" id="btn_plus_' + new_product_index + '"><span class="fa fa-plus"></span></button></span></div><p></p></td><td>(<span class="custom_product_unit_name_' + custom_product_id + '">' + new_product_unit_name + '</span>)</td><td class="showNumeric sum_in_1_product" id="sum_in_a_product_' + new_product_index + '">' + (new_product_price * new_product_quantity) + '</td><td><a id="remove_product_in_order_' + new_product_index + '" class="tooltip-wrapper text-primary remove_product_in_order_' + new_product_index + '" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Xóa sản phẩm này khỏi đơn hàng" href="javascript:void(0)"><i class="fa fa-remove class_icon_remove_' + new_product_index + '" id="id_icon_remove_' + custom_product_id + '"></i></a></td></tr>');
            //$('#new_product_name_' + new_product_index).css({whiteSpace: 'unset'});
            if (new_product_price > 1) {
                $('#btn_minius_' + new_product_index).removeClass('disabled');
            }
            $(".showNumeric").autoNumeric('init', { aSign: ' ₫', pSign: 's', mDec: '0', aSep: '.', aDec: ',' });
            $(".quantity_input").autoNumeric('init', { aSign: '', pSign: 's', mDec: '0', aSep: '.', aDec: ',' });
            inputQuantity(new_product_index);
            resolveCostOrder();
        }

        $.each(list_new_product_index, function (index, value) {
            //Has changed about cost
            $('.input-number_' + value).on('change', function () {
                var cost_of_1_product = $(this).val() * $('#new_product_price_' + value).autoNumeric('get');
                $('#sum_in_a_product_' + value).autoNumeric('set', cost_of_1_product);
                resolveCostOrder();
            });
        });

        $.each(list_new_product_index, function (index, value) {
            //Remove
            $('.remove_product_in_order_' + value).click(function () {
                list_new_product_index = list_new_product_index.filter(function (elem) {
                    return elem != value;
                });
                var cp_id_to_remove = $('.class_icon_remove_' + value).attr('id').match(/\d/g);
                list_custom_product_id = list_custom_product_id.filter(function (elem) {
                    return elem != cp_id_to_remove;
                });
                $('#tr_product_in_order_' + value).remove();
                if (list_new_product_index.length == 0) {
                    $('#btn_is_paid').addClass('disabled');
                    $('#btn_is_pending').addClass('disabled');
                    $('#div_list_product_selected').css({ display: 'none' });
                    $('#text_reason_promotion').css({ display: 'none' });
                    //$('#text_name_of_shipping').css({ display: 'none' });
                    //$('#ship_price').autoNumeric('set', 0);
                    $('#promotion_value').autoNumeric('set', 0);
                }
                resolveCostOrder();
            });
        });

    }

    function addPromotion() {
        $('#modalAddPromotion').modal('show');
        $('#promotion_value_input').on('change', function () {
            if ($('input:radio[name="promotion_type"]:checked').val() == "money") {
                var promotion_value = $('#promotion_value_input').autoNumeric('get');
                var total_cost_product_in_order = $('#total_in_order').autoNumeric('get');
                var sum_in_all_product = $('#sum_in_all_product').autoNumeric('get');
                var ship_price = $('#ship_price').autoNumeric('get');
                if ((parseInt)(promotion_value) > ((parseInt)(sum_in_all_product))) {
                    $('#promotion_value_input').autoNumeric('set', ((parseInt)(sum_in_all_product)));
                }
            }
        });
    }

    function addShippingPrice() {
        var province_id = $('#modal_ddlProvince').val();
        var district_id = $('#modal_ddlDistrict').val();
        var value_for_standard = $('#sum_in_all_product').autoNumeric('get');
        addShippingMethod(province_id, district_id, value_for_standard);
        $('#modalAddShippingPrice').modal('show');
    }

    function addShippingMethod(province_id, district_id, value_for_standard) {
        if (province_id != -1) {
            $('#div_note_suggest_add_customer_info').addClass('hidden_element');
            $('#div_radio_btn_local_shipping_service').empty();
            if (district_id != -1) {
                $.ajax({
                    url: "/ShippingService/GetShippingCostForOrderByDistrict",
                    data: {
                        district_id: district_id,
                        value_for_standard: value_for_standard,
                    },
                    context: document.body,
                    type: "POST",
                    dataType: "html",
                    success: function (data) {
                        var data_json = JSON.parse(data);
                        $.each(data_json, function (i, obj) {
                            $('#div_radio_btn_local_shipping_service').append(
                                '<div class="form-check">' +
                                '<input class= "form-check-input" type = "radio" name = "shipping_type" id = "' + obj.cost_for_district_shipping_id + '" value = "' + obj.price_for_district_shipping_final + '">' +
                                '<label class="form-check-label" id="name_of_cost_for_' + obj.cost_for_district_shipping_id + '" for="' + obj.cost_for_district_shipping_id + '">' + obj.name_of_cost + '</label> </br>' +
                                '<span class="text-info">Phí vận chuyển: </span>' +
                                '<span class="showNumeric text-info">' + obj.price_for_district_shipping_final + '</span>' +
                                '</div >');
                        });
                        $(".showNumeric").autoNumeric('init', { aSign: ' ₫', pSign: 's', mDec: '0', aSep: '.', aDec: ',' });
                    },
                    error: function (xhr) {
                        toastError();
                    }
                });
            } else {
                $.ajax({
                    url: "/ShippingService/GetShippingCostForOrderByProvince",
                    data: {
                        province_id: province_id,
                        value_for_standard: value_for_standard,
                    },
                    context: document.body,
                    type: "POST",
                    dataType: "html",
                    success: function (data) {
                        var data_json = JSON.parse(data);
                        $.each(data_json, function (i, obj) {
                            $('#div_radio_btn_local_shipping_service').append(
                                '<div class="form-check">' +
                                '<input class= "form-check-input" type = "radio" name = "shipping_type" id = "' + obj.cost_of_local_shipping_id + '" value = "' + obj.price_of_cost + '">' +
                                '<label class="form-check-label" id="name_of_cost_for_' + obj.cost_for_district_shipping_id + '" for="' + obj.cost_of_local_shipping_id + '">' + obj.name_of_cost + '</label> </br>' +
                                '<span class="text-info">Phí vận chuyển: </span>' +
                                '<span class="showNumeric text-info">' + obj.price_of_cost + '</span>' +
                                '</div >');
                        });
                        $(".showNumeric").autoNumeric('init', { aSign: ' ₫', pSign: 's', mDec: '0', aSep: '.', aDec: ',' });
                    },
                    error: function (xhr) {
                        toastError();
                    }
                });
            }
        } else {
            $('#div_note_suggest_add_customer_info').removeClass('hidden_element');
            $('#div_radio_btn_local_shipping_service').empty();
        }
    }

    $('input:radio[name="promotion_type"]').change(function () {
        if (this.value == 'money') {
            $("#promotion_value_input").autoNumeric('destroy');
            $("#promotion_value_input").autoNumeric('init', { aSign: ' ₫', pSign: 's', mDec: '0', aSep: '.', aDec: ',' });
            $("#promotion_value_input").attr("placeholder","Nhập số tiền khuyến mãi (không vượt quá tổng giá trị các sản phẩm trên hóa đơn)");
        }
        else if (this.value == 'percent') {
            $("#promotion_value_input").autoNumeric('destroy');
            $("#promotion_value_input").autoNumeric('init', { aSign: ' %', pSign: 's', mDec: '0', aSep: '.', aDec: ',' });
            $("#promotion_value_input").attr("placeholder", "Nhập phần trăm khuyến mãi trong khoảng [0% - 100%]");
        }
        else {
            $("#promotion_value_input").val("");
            $("#promotion_value_input").autoNumeric('destroy');
            $("#promotion_value_input").attr("placeholder", "Nhập mã giảm giá");
        }
    });

    $('input:radio[name="shipping_type"]').change(function () {
        if (this.value == 'other_ship') {
            $("#div_other_shipping").css({ display: 'block' });
        }
        else {
            $("#div_other_shipping").css({ display: 'none' });
        }
    });

    function confirmBtnShippingPrice() {
        var shipping_value = $('input:radio[name="shipping_type"]:checked').val();
        if (shipping_value == 'free_ship') {
            $('#label_small_name_of_shipping').css({ display: 'block' });
            $('#text_name_of_shipping').text("Miễn phí vận chuyển (Free Ship)");
            $('#ship_price').autoNumeric('set', 0);
            $('#modalAddShippingPrice').modal('hide');

            var sum_in_all_product = $('#sum_in_all_product').autoNumeric('get');
            if (sum_in_all_product == 0) {
                var total_in_order = (parseInt)($('#ship_price').autoNumeric('get')) - (parseInt)($('#promotion_value').autoNumeric('get'));
                $('#total_in_order').autoNumeric('set', total_in_order);
            }
            else {
                resolveCostOrder();
            }
        }
        else if (shipping_value == 'other_ship') {
            var name_of_other_ship = $('#name_of_other_ship').val();
            var price_of_other_ship = $('#price_of_other_ship').autoNumeric('get');
            if (name_of_other_ship == null || name_of_other_ship == "") {
                $('#name_of_other_ship_feedback').css({ display: 'block' });
                $('#name_of_other_ship').addClass('is-invalid');

                $('#price_of_other_ship_feedback').css({ display: 'none' });
                $('#price_of_other_ship').removeClass('is-invalid');
            }
            else if (price_of_other_ship == "" || price_of_other_ship == null) {
                $('#price_of_other_ship_feedback').css({ display: 'block' });
                $('#price_of_other_ship').addClass('is-invalid');

                $('#name_of_other_ship_feedback').css({ display: 'none' });
                $('#name_of_other_ship').removeClass('is-invalid');
            }
            else {
                $('#name_of_other_ship_feedback').css({ display: 'none' });
                $('#name_of_other_ship').removeClass('is-invalid');
                $('#price_of_other_ship_feedback').css({ display: 'none' });
                $('#price_of_other_ship').removeClass('is-invalid');

                $('#label_small_name_of_shipping').css({ display: 'block' });
                $('#text_name_of_shipping').text(name_of_other_ship);
                $('#ship_price').autoNumeric('set', price_of_other_ship);
                $('#modalAddShippingPrice').modal('hide');
                var sum_in_all_product = $('#sum_in_all_product').autoNumeric('get');
                if (sum_in_all_product == 0) {
                    var total_in_order = (parseInt)($('#ship_price').autoNumeric('get')) - (parseInt)($('#promotion_value').autoNumeric('get'));
                    $('#total_in_order').autoNumeric('set', total_in_order);
                }
                else {
                    resolveCostOrder();
                }
                if ($('#text_name_of_shipping').text().length > 0) {
                    $('#shipping_price_action').text("Sửa");
                }
            }
        }
        else {
            var id = $('input:radio[name="shipping_type"]:checked').attr('id');
            var name_of_cost_to_set_text = $('#name_of_cost_for_' + id).text();
            $('#name_of_other_ship_feedback').css({ display: 'none' });
            $('#name_of_other_ship').removeClass('is-invalid');
            $('#price_of_other_ship_feedback').css({ display: 'none' });
            $('#price_of_other_ship').removeClass('is-invalid');

            $('#label_small_name_of_shipping').css({ display: 'block' });
            $('#text_name_of_shipping').text(name_of_cost_to_set_text);
            $('#ship_price').autoNumeric('set', shipping_value);
            $('#modalAddShippingPrice').modal('hide');
            var sum_in_all_product = $('#sum_in_all_product').autoNumeric('get');
            if (sum_in_all_product == 0) {
                var total_in_order = (parseInt)($('#ship_price').autoNumeric('get')) - (parseInt)($('#promotion_value').autoNumeric('get'));
                $('#total_in_order').autoNumeric('set', total_in_order);
            }
            else {
                resolveCostOrder();
            }
            if ($('#text_name_of_shipping').text().length > 0) {
                $('#shipping_price_action').text("Sửa");
            }
        }
    }

    var isPromotion = false;
    function confirmBtnPromotion() {
        var text_reason_promotion = $('#promotion_reason_input').val();
        var promotion_radio_value = $('input:radio[name="promotion_type"]:checked').val();
        if (promotion_radio_value == 'money') {
            var promotion_value = $('#promotion_value_input').autoNumeric('get');
            var total_cost_product_in_order = $('#total_in_order').autoNumeric('get');
            $('#label_small_reason_promotion').css({ display: 'block' });
            $('#text_reason_promotion').text(text_reason_promotion);
            $('#promotion_value_action').text("Sửa");

            if (promotion_value == 0 || promotion_value == null) {
                $('#promotion_value_input_feedback').css({ display: 'block' });
                $('#promotion_value_input').addClass('is-invalid');

                $('#promotion_percent_input_feedback').css({ display: 'none' });
                $('#promotion_code_input_feedback').css({ display: 'none' });
            }
            else {
                $('#promotion_value').autoNumeric('set', promotion_value);
                $('#promotion_percent_input_feedback').css({ display: 'none' });
                $('#promotion_value_input_feedback').css({ display: 'none' });
                $('#promotion_code_input_feedback').css({ display: 'none' });
                $('#promotion_value_input').removeClass('is-invalid');

                var sum_in_all_product = $('#sum_in_all_product').autoNumeric('get');
                if (sum_in_all_product == 0) {
                    var total_in_order = (parseInt)($('#ship_price').autoNumeric('get')) - (parseInt)($('#promotion_value').autoNumeric('get'));
                    $('#total_in_order').autoNumeric('set', total_in_order);
                }
                else {
                    resolveCostOrder();
                }
                isPromotion = false;
                $('#modalAddPromotion').modal('hide');
            }
        }
        else if (promotion_radio_value == 'percent') {
            var promotion_value = $('#promotion_value_input').autoNumeric('get');
            var total_cost_product_in_order = $('#total_in_order').autoNumeric('get');
            var sum_in_all_product = $('#sum_in_all_product').autoNumeric('get');
            var ship_price = $('#ship_price').autoNumeric('get');

            if (promotion_value == 0 || promotion_value == null) {
                $('#promotion_value_input_feedback').css({ display: 'block' });
                $('#promotion_value_input').addClass('is-invalid');

                $('#promotion_percent_input_feedback').css({ display: 'none' });
                $('#promotion_code_input_feedback').css({ display: 'none' });
            }
            else {
                if (promotion_value < 1 || promotion_value > 100) {
                    $('#promotion_percent_input_feedback').css({ display: 'block' });
                    $('#promotion_value_input').addClass('is-invalid');

                    $('#promotion_value_input_feedback').css({ display: 'none' });
                    $('#promotion_code_input_feedback').css({ display: 'none' });
                }
                else {
                    $('#promotion_percent_input_feedback').css({ display: 'none' });
                    $('#promotion_value_input_feedback').css({ display: 'none' });
                    $('#promotion_code_input_feedback').css({ display: 'none' });
                    $('#promotion_value_input').removeClass('is-invalid');

                    var promotion_value_pass_to_money = ((parseInt)(sum_in_all_product)) * (promotion_value / 100);

                    $('#label_small_reason_promotion').css({ display: 'block' });
                    $('#text_reason_promotion').text(text_reason_promotion + " (Giá trị khuyến mãi: " + promotion_value + "%)");
                    $('#text_reason_promotion').css({ overflow: 'hidden', textOverflow: 'ellipsis' });
                    $('#promotion_value').autoNumeric('set', promotion_value_pass_to_money);
                    $('#promotion_value_action').text("Sửa");

                    var sum_in_all_product = $('#sum_in_all_product').autoNumeric('get');
                    if (sum_in_all_product == 0) {
                        var total_in_order = (parseInt)($('#ship_price').autoNumeric('get')) - (parseInt)($('#promotion_value').autoNumeric('get'));
                        $('#total_in_order').autoNumeric('set', total_in_order);
                    }
                    else {
                        resolveCostOrder();
                    }
                    isPromotion = false;
                    $('#modalAddPromotion').modal('hide');
                }
            }
        }
        else {
            var list_quantity_pv = [];
            $.each(list_product_variation_id, function (key, value) {
                var quantity_pv = {};
                quantity_pv.product_variation_id = value;
                quantity_pv.product_variation_quantity = $('#id_input_quantity_' + value).val();
                quantity_pv.unit_name = $('#product_variation_unit_name_' + value).text();
                list_quantity_pv.push(quantity_pv);
            });

            var coupon_code = $('#promotion_value_input').val().trim();
            var customer_id = customer_id_selected;
            var total_cost_of_product_in_order = $('#sum_in_all_product').autoNumeric('get');
            var cost_of_shipping_for_this_order = $('#ship_price').autoNumeric('get');
            var province_id = $('#modal_ddlProvince').val();

            if (coupon_code == "" || coupon_code == null) {
                $('#promotion_percent_input_feedback').css({ display: 'none' });
                $('#promotion_value_input_feedback').css({ display: 'none' });
                $('#promotion_value_input').addClass('is-invalid');
                $('#promotion_code_input_feedback').css({ display: 'block' });
                $('#promotion_code_input_feedback').text("Yêu cầu nhập mã giảm giá.");
            }
            else {
                $.ajax({
                    url: "/Coupon/CheckCoupon",
                    data: {
                        coupon_code: coupon_code,
                        customer_id: customer_id,
                        total_cost_of_product_in_order: total_cost_of_product_in_order,
                        province_id: province_id,
                        list_product_variation_id: list_product_variation_id,
                        cost_of_shipping_for_this_order: cost_of_shipping_for_this_order,
                        list_quantity_pv: list_quantity_pv
                    },
                    context: document.body,
                    type: "POST",
                    dataType: "html",
                    success: function (data) {
                        var data_json = JSON.parse(data);
                        if (data_json.coupon_invalid_status == false) {
                            $('#promotion_percent_input_feedback').css({ display: 'none' });
                            $('#promotion_value_input_feedback').css({ display: 'none' });
                            $('#promotion_value_input').addClass('is-invalid');
                            $('#promotion_code_input_feedback').css({ display: 'block' });
                            $('#promotion_code_input_feedback').text(data_json.coupon_invalid_description);
                        } else {
                            $('#promotion_value_input').removeClass('is-invalid');
                            $('#promotion_code_input_feedback').css({ display: 'none' });
                            $('#promotion_percent_input_feedback').css({ display: 'none' });
                            $('#promotion_value_input_feedback').css({ display: 'none' });

                            $('#label_small_reason_promotion').css({ display: 'block' });
                            $('#text_reason_promotion').text("Mã giảm giá: " + coupon_code);
                            $('#text_reason_promotion').css({ overflow: 'hidden', textOverflow: 'ellipsis' });
                            $('#promotion_value').autoNumeric('set', data_json.discount_value_return);
                            $('#promotion_value_action').text("Sửa");

                            resolveCostOrder();
                            isPromotion = true;
                            $('#modalAddPromotion').modal('hide');
                        }
                    },
                    error: function (xhr) {
                        toastError();
                    }
                });
            }
        }
    }

    function cancelPromotionModal() {
        var promotion_radio_value = $('input:radio[name="promotion_type"]:checked').val();
        if (promotion_radio_value != 'money' || promotion_radio_value != 'percent') {
            $('#promotion_percent_input_feedback').css({ display: 'none' });
            $('#promotion_value_input_feedback').css({ display: 'none' });
            $('#promotion_code_input_feedback').css({ display: 'none' });
            $('#promotion_value_input').removeClass('is-invalid');
            $('#promotion_value_input').val("");
        }
    }

    $('#promotion_value_input').keyup(function () {
        $('#promotion_percent_input_feedback').css({ display: 'none' });
        $('#promotion_value_input_feedback').css({ display: 'none' });
        $('#promotion_code_input_feedback').css({ display: 'none' });
        $('#promotion_value_input').removeClass('is-invalid');
    });

    $('#promotion_value_input').on('paste',function () {
        $('#promotion_percent_input_feedback').css({ display: 'none' });
        $('#promotion_value_input_feedback').css({ display: 'none' });
        $('#promotion_code_input_feedback').css({ display: 'none' });
        $('#promotion_value_input').removeClass('is-invalid');
    });

    function inputQuantity(id) {
        //plugin bootstrap minus and plus
        $('.btn-number_' + id).click(function (e) {
            e.preventDefault();

            fieldName = $(this).attr('data-field');
            type = $(this).attr('data-type');
            var input = $("input[name='" + fieldName + "']");
            var currentVal = parseInt(input.val());
            if (!isNaN(currentVal)) {
                if (type == 'minus') {
                    if (currentVal > input.attr('min')) {
                        input.val(currentVal - 1).change();
                    }
                    if (parseInt(input.val()) == input.attr('min')) {
                        $(this).removeClass('disabled');
                        $(this).addClass('disabled');
                    }

                } else if (type == 'plus') {

                    if (currentVal < input.attr('max')) {
                        input.val(currentVal + 1).change();
                    }
                    if (parseInt(input.val()) == input.attr('max')) {
                        $(this).removeClass('disabled');
                        $(this).addClass('disabled');
                    }

                }
            } else {
                input.val(0);
            }
        });


        $('.input-number_' + id).focusin(function () {
            $(this).data('oldValue', $(this).val());
        });

        $('.input-number_' + id).change(function () {
            minValue = ($(this).attr('min'));
            maxValue = ($(this).attr('max'));
            valueCurrent = parseInt($(this).val());
            name = $(this).attr('name');
            if (valueCurrent >= minValue) {
                $(".btn-number_" + id + "[data-type='minus'][data-field='" + name + "']").removeClass('disabled')
            } else {
                //alert('Số lượng sản phẩm phải lớn hơn 1');
                $(this).val($(this).data('oldValue'));
            }
            if (valueCurrent <= maxValue) {
                $(".btn-number_" + id + "[data-type='plus'][data-field='" + name + "']").removeClass('disabled')
            } else {
                //alert('Số lượng sản phẩm giới hạn 10.000');
                $(this).val($(this).data('oldValue'));
            }


        });
        $(".input-number_" + id).keydown(function (e) {
            // Allow: backspace, delete, tab, escape, enter and .
            if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 190]) !== -1 ||
                // Allow: Ctrl+A
                (e.keyCode == 65 && e.ctrlKey === true) ||
                // Allow: home, end, left, right
                (e.keyCode >= 35 && e.keyCode <= 39)) {
                // let it happen, don't do anything
                return;
            }
            // Ensure that it is a number and stop the keypress
            if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                e.preventDefault();
            }
        });
    }


    function moveToCustomerInfoCard() {
        $('#modalAddShippingPrice').modal('hide');
        $("html, body").animate({ scrollTop: 0 }, 600);
    }

    //Filter PartialView
    var string_value_to_filter = "";
    $('#filter-by-product-status').on('change', function () {
        var quick_filter_value = this.value;
        string_value_to_filter = this.value;
        var quick_filter = $("#select-filter option:selected").val();
        var search_string = $('#search_input').val().trim();
        $.ajax({
            url: "/Product/IndexProductNotAction",
            data: {
                search_string: search_string,
                page_num: 1,
                quick_filter_value: quick_filter_value,
                quick_filter: quick_filter
            },
            context: document.body,
            type: "GET",
            dataType: "html",
            success: function (data) {
                $("#data_table_not_action").html($(data).find("#data_table_not_action"));
                $(".showNumeric").autoNumeric('init', { aSign: ' ₫', pSign: 's', mDec: '0', aSep: '.', aDec: ',' });
            },
            error: function (xhr, status) {
            },
            complete: function (xhr, status) {
                //$('#showresults').slideDown('slow')
            }
        });
    });

    $('#filter-by-category').on('change', function () {
        var quick_filter_value = this.value;
        string_value_to_filter = this.value;
        var quick_filter = $("#select-filter option:selected").val();
        var search_string = $('#search_input').val().trim();
        $.ajax({
            url: "/Product/IndexProductNotAction",
            data: {
                search_string: search_string,
                page_num: 1,
                quick_filter_value: quick_filter_value,
                quick_filter: quick_filter
            },
            context: document.body,
            type: "GET",
            dataType: "html",
            success: function (data) {
                $("#data_table_not_action").html($(data).find("#data_table_not_action"));
                $(".showNumeric").autoNumeric('init', { aSign: ' ₫', pSign: 's', mDec: '0', aSep: '.', aDec: ',' });
            },
            error: function (xhr, status) {
            },
            complete: function (xhr, status) {
            }
        });
    });

    $('#filter-by-supplier').on('change', function () {
        var quick_filter_value = this.value;
        string_value_to_filter = this.value;
        var quick_filter = $("#select-filter option:selected").val();
        var search_string = $('#search_input').val().trim();
        $('.progressLoading').css('display', 'block');
        $.ajax({
            url: "/Product/IndexProductNotAction",
            data: {
                search_string: search_string,
                page_num: 1,
                quick_filter_value: quick_filter_value,
                quick_filter: quick_filter
            },
            context: document.body,
            type: "GET",
            dataType: "html",
            success: function (data) {
                $("#data_table_not_action").html($(data).find("#data_table_not_action"));
                $(".showNumeric").autoNumeric('init', { aSign: ' ₫', pSign: 's', mDec: '0', aSep: '.', aDec: ',' });
            },
            error: function (xhr, status) {
            },
            complete: function (xhr, status) {
                //$('#showresults').slideDown('slow')
            }
        });
    });

    $('#search_input').keypress(function (e) {
        if (e.which == 13) {
            var search_string = $('#search_input').val().trim();
            var quick_filter_value = string_value_to_filter;
            var quick_filter = $("#select-filter option:selected").val();
            $.ajax({
                url: "/Product/IndexProductNotAction",
                data: {
                    search_string: search_string,
                    page_num: 1,
                    quick_filter_value: quick_filter_value,
                    quick_filter: quick_filter
                },
                context: document.body,
                type: "GET",
                dataType: "html",
                success: function (data) {
                    $("#data_table_not_action").html($(data).find("#data_table_not_action"));
                    $(".showNumeric").autoNumeric('init', { aSign: ' ₫', pSign: 's', mDec: '0', aSep: '.', aDec: ',' });
                },
                error: function (xhr, status) {
                },
                complete: function (xhr, status) {
                }
            });
        }
    });




    //Script for List Customer
    function tabFilter() {
        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            var target = $(e.target).attr("id");
            var search_string = $('#search_input_customer').val().trim();
            var quick_filter_select = $("#select_filter option:selected").val();
            var quick_filter_condition = $("#select_condition_filter option:selected").val();
            var quick_filter_value = $("#value_select_condition").val();
            var size_of_page = $("#size_of_page_select option:selected").val();
            var sort_list_return = $("#sort_list_return_select option:selected").val();
            var quick_filer_tab = target;
            if (quick_filter_value == null) {
                quick_filter_value = 0;
            }
            $.ajax({
                url: "/Customer/IndexCustomerListSelect",
                data: {
                    search_string: search_string,
                    page_num: 1,
                    quick_filter_select: quick_filter_select,
                    quick_filter_condition: quick_filter_condition,
                    quick_filter_value: 0,
                    size_of_page: size_of_page,
                    quick_filer_tab: quick_filer_tab,
                    sort_list_return: sort_list_return,
                },
                context: document.body,
                type: "GET",
                dataType: "html",
                success: function (data) {
                    $("#data_table").html($(data).find("#data_table"));
                },
                error: function (xhr, status) {
                },
                complete: function (xhr, status) {
                }
            });
        });
    }

    $('#select_filter').on('change', function () {
        var select_filter = this.value;
        var search_string = $('#search_input_customer').val().trim();

        if (select_filter != "all") {
            $('#select_condition_filter').css('display', 'block');

            switch (select_filter) {
                case "money_purchased":
                    $('#select_condition_filter').empty();
                    $('#value_select_condition').css({ display: 'block' });
                    $('#value_select_condition').attr('placeholder','₫');
                    $("#value_select_condition").autoNumeric('init', { aSign: ' ₫', pSign: 's', mDec: '0', aSep: '.', aDec: ',' });

                    $("#select_condition_filter").append('<option value="' + "money_purchased_>" + '">' + "Lớn hơn" + '</option>');
                    $("#select_condition_filter").append('<option value="' + "money_purchased_<" + '">' + "Nhỏ hơn" + '</option>');
                    $("#select_condition_filter").append('<option value="' + "money_purchased_=" + '">' + "Bằng" + '</option>');
                    $("#select_condition_filter").append('<option value="' + "money_purchased_#" + '">' + "Khác" + '</option>');
                    break;
                case "number_of_order":
                    $('#select_condition_filter').empty();
                    $('#value_select_condition').css({ display: 'block' });
                    $('#value_select_condition').attr('placeholder', 'Nhập số lượng');
                    $("#value_select_condition").autoNumeric('init', { aSign: ' ', pSign: 's', mDec: '0', aSep: '.', aDec: ',' });

                    $("#select_condition_filter").append('<option value="' + "number_of_order_>" + '">' + "Có số lượng lớn hơn" + '</option>');
                    $("#select_condition_filter").append('<option value="' + "number_of_order_<" + '">' + "Có số lượng nhỏ hơn" + '</option>');
                    $("#select_condition_filter").append('<option value="' + "number_of_order_=" + '">' + "Có số lượng bằng" + '</option>');
                    $("#select_condition_filter").append('<option value="' + "number_of_order_#" + '">' + "Có số lượng khác" + '</option>');
                    break;
                case "time_to_order":
                    $('#select_condition_filter').empty();
                    $('#value_select_condition').css({ display: 'none' });

                    $("#select_condition_filter").append('<option value="' + "time_to_order_this_week" + '">' + "Trong tuần này" + '</option>');
                    $("#select_condition_filter").append('<option value="' + "time_to_order_this_month" + '">' + "Trong tháng này" + '</option>');
                    $("#select_condition_filter").append('<option value="' + "time_to_order_today" + '">' + "Trong ngày hôm nay" + '</option>');
                    $("#select_condition_filter").append('<option value="' + "time_to_order_yesterday" + '">' + "Trong ngày hôm qua" + '</option>');
                    $("#select_condition_filter").append('<option value="' + "time_to_order_before_day" + '">' + "Trước ngày" + '</option>');
                    $("#select_condition_filter").append('<option value="' + "time_to_order_after_day" + '">' + "Sau ngày" + '</option>');
                    break;
                case "customer_tag":
                    $('#select_condition_filter').empty();
                    $('#value_select_condition').css({ display: 'block' });
                    $('#value_select_condition').attr('placeholder', 'Nhập từ khóa tag');
                    $("#value_select_condition").autoNumeric('destroy');

                    $("#select_condition_filter").append('<option value="' + "tag_string_contain>" + '">' + "Chứa từ" + '</option>');
                    break;
                case "customer_address":
                    $('#select_condition_filter').empty();
                    $('#value_select_condition').css({ display: 'none' });

                    $.ajax({
                        type: "GET",
                        data: {  },
                        url: '@Url.Action("GetAllProvince", "GetLocal")',
                        success: function (data) {
                            $("#select_condition_filter").append('<option value="-1" disabled selected>-- Chọn Tỉnh/Thành phố --</option>');
                            $.each(data, function (key, value) {
                                $("#select_condition_filter").append('<option value="' + value.province_name + '"> ' + value.province_name + '</option>');
                            });
                        },
                        error: function (xhr) {
                            toastExportError();
                        }
                    });
                    break;
                case "customer_month_of_birth":
                    $('#value_select_condition').css({ display: 'none' });
                    var arr_month = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];
                    $('#select_condition_filter').empty();
                    $("#select_condition_filter").append('<option value="all">-- Chọn tháng --</option>');
                    $.each(arr_month, function (key, value) {
                        $("#select_condition_filter").append('<option value="' + value + '"> ' + "Tháng " + value + '</option>');
                    });
                    break;
                default:
                    console.log('Not Find Result');

            }
        }
        else {
            $('#select_condition_filter').css({ display: 'none' });
            $('#value_select_condition').css({ display: 'none' });
            searchCustomerCommon();
        }
    });

    $('#size_of_page_select').on('change', function () {
        searchCustomerCommon();
    });

    $('#sort_list_return_select').on('change', function () {
        searchCustomerCommon();
    });

    $('#select_condition_filter').on('change', function () {
        searchCustomerCommon();
    });

    $('#search_input_customer').keypress(function (e) {
        if (e.which == 13) {
            searchCustomerCommon();
        }
    });

    function searchCustomer() {
        searchCustomerCommon();
    }

    function searchCustomerCommon() {
        var search_string = $('#search_input_customer').val().trim();
        var target = $('ul > li.li_tab_list_customer_to_select> a.active').attr("id");
        var quick_filter_select = $("#select_filter option:selected").val();
        var quick_filter_condition = $("#select_condition_filter option:selected").val();
        var quick_filter_value = $("#value_select_condition").val();
        var size_of_page = $("#size_of_page_select option:selected").val();
        var sort_list_return = $("#sort_list_return_select option:selected").val();
        var quick_filer_tab = target;
        if (quick_filter_value == null) {
            quick_filter_value = 0;
        }

        $.ajax({
            url: "/Customer/IndexCustomerListSelect",
            data: {
                search_string: search_string,
                page_num: 1,
                quick_filter_select: quick_filter_select,
                quick_filter_condition: quick_filter_condition,
                quick_filter_value: 0,
                size_of_page: size_of_page,
                quick_filer_tab: quick_filer_tab,
                sort_list_return: sort_list_return,
            },
            context: document.body,
            type: "GET",
            dataType: "html",
            success: function (data) {
                $("#data_table").html($(data).find("#data_table"));
            },
            error: function (xhr, status) {
            },
            complete: function (xhr, status) {
            }
        });
    }

    $('#search_customer_in_list_from_db').on('click', function () {
        $('#modalSelectCustomer').modal('show');
        searchCustomerCommon();
    });

    function getDeliveryAddressExist(delivery_address_id) {
        delivery_address_id_selected = delivery_address_id;
        $.ajax({
            url: "/Customer/GetDeliveryAddressById",
            data: {
                delivery_address_id: delivery_address_id
            },
            context: document.body,
            type: "POST",
            dataType: "html",
            beforeSend: function () {
                $('#btn_confirm_delivery_address').addClass('buttonload disabled');
                $('.fa-spin').remove();
                $('#btn_confirm_delivery_address').append('<i class="fa fa-spinner fa-spin"></i>');
            },
            success: function (model) {
                var data_da = JSON.parse(model);
                $('#modal_customer_first_name').val(data_da.first_name);
                $('#modal_customer_last_name').val(data_da.last_name);
                $('#modal_customer_phone_number').val(data_da.phone_number);
                $('#modal_customer_address_detail').val(data_da.address_detail);
                if (data_da.province_id != null) {
                    $('#modal_ddlProvince').val(data_da.province_id);
                } else {
                    $('#modal_ddlProvince').val(-1);
                }
                if (data_da.district_id != null) {
                    getDistrictForCustomerByDistrictId(data_da.province_id, data_da.district_id);
                } else {
                    $('#modal_ddlDistrict').empty();
                    $('#modal_ddlDistrict').append('<option value="-1">-- Chưa được chọn --</option>');
                    $('#modal_ddlWard').empty();
                    $('#modal_ddlWard').append('<option value="-1">-- Chưa được chọn --</option>');
                }
                if (data_da.ward_id != null) {
                    getWardForCustomerByWardId(data_da.district_id, data_da.ward_id);
                } else {
                    $('#modal_ddlWard').empty();
                    $('#modal_ddlWard').append('<option value="-1">-- Chưa được chọn --</option>');
                }
            },
            error: function (xhr) {
                toastError();
            },
            complete: function (xhr, status) {
                $('#btn_confirm_delivery_address').removeClass('buttonload disabled');
                $('.fa-spin').remove();
            }
        });
    }

    var customer_id_selected = 0;
    var delivery_address_id_selected = 0;
    var email_before_check = "";
    function selectThisCustomer(customer_id) {
        customer_id_selected = customer_id;
        $.ajax({
            url: "/Customer/GetCustomerByCustomerId",
            data: {
                customer_id: customer_id
            },
            context: document.body,
            type: "POST",
            dataType: "html",
            success: function (data) {
                var data_json = JSON.parse(data);
                delivery_address_id_selected = data_json.customer_data.customer_default_delivery_address;
                email_before_check = data_json.customer_data.customer_email;
                if (data_json.number_official_order == 0) {
                    $('#info_number_of_order').text("Chưa có");
                } else {
                    $('#info_number_of_order').text(data_json.number_official_order);
                }
                $('#modal_edit_customer_email').val(data_json.customer_data.customer_email);
                $('#card_delivery_address').removeClass('hidden_element');
                $('#div_contact_customer_selected').removeClass('hidden_element');
                $('#btn_remove_customer_selected').removeClass('hidden_element');
                $('#div_customer_null').addClass('hidden_element');
                $('#btn_show_modal_create_customer').addClass('hidden_element');

                if (data_json.customer_data.customer_first_name == null && data_json.customer_data.customer_last_name == null) {
                    $('#info_customer_fullname').text("Unnamed");
                    $('#info_customer_fullname').removeClass('text-primary');
                    $('#info_customer_fullname').addClass('text-secondary');
                } else {
                    $('#info_customer_fullname').text(data_json.customer_data.customer_first_name + " " + data_json.customer_data.customer_last_name);
                    $('#info_customer_fullname').removeClass('text-secondary');
                    $('#info_customer_fullname').addClass('text-primary');
                }
                if (data_json.customer_data.customer_email == null) {
                    $('#info_customer_email').text("");
                } else {
                    $('#info_customer_email').text(data_json.customer_data.customer_email);
                }
                if (data_json.customer_data.customer_phone_number == null) {
                    $('#info_customer_phone_number').text("");
                } else {
                    $('#info_customer_phone_number').text(data_json.customer_data.customer_phone_number);
                }

                //Update Delivery Address
                $('#modal_customer_first_name').val(data_json.customer_data.customer_first_name);
                $('#modal_customer_last_name').val(data_json.customer_data.customer_last_name);
                $('#modal_customer_phone_number').val(data_json.customer_data.customer_phone_number);
                $('#modal_customer_address_detail').val(data_json.customer_data.customer_address_detail);
                if (data_json.customer_data.customer_first_name == null && data_json.customer_data.customer_last_name == null) {
                    $('#text_firstname').text("");
                    $('#text_lastname').text("");
                } else {
                    $('#text_firstname').text(data_json.customer_data.customer_first_name);
                    $('#text_lastname').text(data_json.customer_data.customer_last_name);
                }
                if (data_json.customer_data.customer_phone_number == null) {
                    $('#text_phone_number').text("");
                } else {
                    $('#text_phone_number').text(data_json.customer_data.customer_phone_number);
                }

                if (data_json.customer_data.customer_province_id == null) {
                    $('#modal_ddlProvince').val(-1);
                    $('#text_province').text("");
                    $('#text_province_id').text(-1);
                } else {
                    $('#modal_ddlProvince').val(data_json.customer_data.customer_province_id);
                    $('#text_province').text(data_json.customer_data.customer_province);
                    $('#text_province_id').text(data_json.customer_data.customer_province_id);
                }
                if (data_json.customer_data.customer_district_id == null) {
                    $('#modal_ddlDistrict').empty();
                    $('#modal_ddlDistrict').append('<option value="-1">-- Chưa được chọn --</option>');
                    $('#modal_ddlWard').empty();
                    $('#modal_ddlWard').append('<option value="-1">-- Chưa được chọn --</option>');
                    $('#text_district').text("");
                    $('#text_ward').text("");
                    $('#text_district_id').text(-1);
                    $('#text_ward_id').text(-1);
                } else {
                    getDistrictForCustomerByDistrictId(data_json.customer_data.customer_province_id, data_json.customer_data.customer_district_id)
                    $('#text_district').text(data_json.customer_data.customer_district);
                    $('#text_district_id').text(data_json.customer_data.customer_district_id);
                }
                if (data_json.customer_data.customer_ward_id == null) {
                    $('#modal_ddlWard').empty();
                    $('#modal_ddlWard').append('<option value="-1">-- Chưa được chọn --</option>');
                    $('#text_ward').text("");
                    $('#text_ward_id').text(-1);
                } else {
                    getWardForCustomerByWardId(data_json.customer_data.customer_district_id, data_json.customer_data.customer_ward_id)
                    $('#text_ward').text(data_json.customer_data.customer_ward);
                    $('#text_ward_id').text(data_json.customer_data.customer_ward_id);
                }
                if (data_json.customer_data.customer_address_detail == null) {
                    $('#text_address_detail').text("");
                } else {
                    $('#text_address_detail').text(data_json.customer_data.customer_address_detail);
                }

                //Get list delivery address suggest
                $('#dropdown_select_delivery_address').empty();
                $.each(data_json.list_da, function (i, da) {
                    $('#dropdown_select_delivery_address').append(
                        '<a class="dropdown-item" id="da_id_' + da.delivery_address_id +'" href="javascript:void(0)"> ' +
                        '<span>' +
                        '<i class="ti ti-user text-info"></i> &nbsp;&nbsp; <span id="da_name_' + da.delivery_address_id + '">' + (da.first_name != null ? '' + da.first_name + '&nbsp;' + '' : '') + (da.last_name != null ? '' + da.last_name + " " + '' : '') + '</span>' +
                        '</span > <br />' +
                        '<span>' +
                        '<i class="ti ti-mobile text-info"></i>&nbsp;&nbsp; <span id="da_phone_number_' + da.delivery_address_id + '">' + (da.phone_number != null ? '' + da.phone_number + " " + '' : '') +'</span>' +
                        '</span> <br />' +
                        '<span>' +
                        '<i class="ti ti-flag text-info"></i>&nbsp;&nbsp; <span id="da_country_' + da.delivery_address_id +'">Việt Nam</span>' +
                        '</span> <br />' +
                        '<span>' +
                        '<i class="ti ti-home text-info"></i>&nbsp;&nbsp; <span id="da_home_' + da.delivery_address_id + '">' + (da.address_detail != null ? '' + da.address_detail + " - " + '' : '') + (da.ward_name != null ? '' + da.ward_name + " - " + '' : '') + (da.district_name != null ? '' + da.district_name + " - " + '' : '') + (da.province_name != null ? '' + da.province_name + '' : '') + '</span>' +
                        '</span>' +
                        '</a >' +
                        '<a class="dropdown-item disabled show_line_dropdown" href="javascript:void(0)"></a>');

                    $('#da_id_' + da.delivery_address_id).click(function () {
                        delivery_address_id_selected = da.delivery_address_id;
                        $.ajax({
                            url: "/Customer/GetDeliveryAddressById",
                            data: {
                                delivery_address_id: da.delivery_address_id
                            },
                            context: document.body,
                            type: "POST",
                            dataType: "html",
                            beforeSend: function () {
                                $('#btn_confirm_delivery_address').addClass('buttonload disabled');
                                $('.fa-spin').remove();
                                $('#btn_confirm_delivery_address').append('<i class="fa fa-spinner fa-spin"></i>');
                            },
                            success: function (model) {
                                var data_da = JSON.parse(model);
                                $('#modal_customer_first_name').val(data_da.first_name);
                                $('#modal_customer_last_name').val(data_da.last_name);
                                $('#modal_customer_phone_number').val(data_da.phone_number);
                                $('#modal_customer_address_detail').val(data_da.address_detail);
                                if (data_da.province_id != null) {
                                    $('#modal_ddlProvince').val(data_da.province_id);
                                } else {
                                    $('#modal_ddlProvince').val(-1);
                                }
                                if (data_da.district_id != null) {
                                    getDistrictForCustomerByDistrictId(data_da.province_id, data_da.district_id);
                                } else {
                                    $('#modal_ddlDistrict').empty();
                                    $('#modal_ddlDistrict').append('<option value="-1">-- Chưa được chọn --</option>');
                                    $('#modal_ddlWard').empty();
                                    $('#modal_ddlWard').append('<option value="-1">-- Chưa được chọn --</option>');
                                }
                                if (data_da.ward_id != null) {
                                    getWardForCustomerByWardId(data_da.district_id, data_da.ward_id);
                                } else {
                                    $('#modal_ddlWard').empty();
                                    $('#modal_ddlWard').append('<option value="-1">-- Chưa được chọn --</option>');
                                }
                            },
                            error: function (xhr) {
                                toastError();
                            },
                            complete: function (xhr, status) {
                                $('#btn_confirm_delivery_address').removeClass('buttonload disabled');
                                $('.fa-spin').remove();
                            }
                        });
                    });
                });

            },
            error: function (xhr, status) {
            },
            complete: function (xhr, status) {
            }
        });
    }

    function editEmailInOrder() {
        $('#modalEditEmail').modal('show');
    }

    function removeCustomerSelected() {
        customer_id_selected = 0;
        delivery_address_id_selected = 0;
        email_before_check = "";
        $('#div_contact_customer_selected').addClass('hidden_element');
        $('#btn_remove_customer_selected').addClass('hidden_element');
        $('#btn_show_modal_create_customer').removeClass('hidden_element');
        $('#div_customer_null').removeClass('hidden_element');

        $('#card_delivery_address').addClass('hidden_element');
        $('#modal_customer_first_name').val(customer.customer_first_name);
        $('#modal_customer_last_name').val(customer.customer_last_name);
        $('#modal_customer_phone_number').val(customer.customer_phone_number);
        $('#modal_customer_address_detail').val(customer.customer_address_detail);
        $('#modal_ddlProvince').val(-1);
        $('#modal_ddlDistrict').empty();
        $('#modal_ddlDistrict').append('<option value="-1">-- Chưa được chọn --</option>');
        $('#modal_ddlWard').empty();
        $('#modal_ddlWard').append('<option value="-1">-- Chưa được chọn --</option>');
    }

    function getAllDistrictByProvinceId(province_id) {
        $.ajax({
            type: "GET",
            data: { id: province_id },
            url: '@Url.Action("GetAllDistrictByProvinceId", "GetLocal")',
            success: function (data) {
                $("#modal_ddlDistrict").empty();
                $("#modal_ddlDistrict").append('<option value="-1">-- Chọn Quận/Huyện --</option>');
                $.each(data, function (key, value) {
                    $("#modal_ddlDistrict").append('<option value="' + value.district_id + '"> ' + value.district_type + " " + value.district_name + '</option>');
                });
                $("#modal_ddlDistrict").val(-1);
            },
            error: function (xhr) {
            }
        });
    }

    function getDistrictForCustomerByDistrictId(province_id, district_id) {
        $.ajax({
            type: "GET",
            data: { id: province_id },
            url: '@Url.Action("GetAllDistrictByProvinceId", "GetLocal")',
            success: function (data) {
                $("#modal_ddlDistrict").empty();
                $("#modal_ddlDistrict").append('<option value="-1">-- Chọn Quận/Huyện --</option>');
                $.each(data, function (key, value) {
                    $("#modal_ddlDistrict").append('<option value="' + value.district_id + '"> ' + value.district_type + " " + value.district_name + '</option>');
                });
                $("#modal_ddlDistrict").val(district_id);
            },
            error: function (xhr) {
            }
        });
    }

    function getWardForCustomerByWardId(district_id, ward_id) {
        $.ajax({
            type: "GET",
            data: { id: district_id },
            url: '@Url.Action("GetAllWardByDistrictId", "GetLocal")',
            success: function (data) {
                $("#modal_ddlWard").empty();
                $("#modal_ddlWard").append('<option value="-1">-- Chọn Phường/Xã --</option>');
                $.each(data, function (key, value) {
                    $("#modal_ddlWard").append('<option value="' + value.ward_id + '"> ' + value.ward_type + " " + value.ward_name + '</option>');
                });
                $("#modal_ddlWard").val(ward_id);
            },
            error: function (xhr) {
            }
        });
    }

    function editDeliveryAddress() {
        $('#modalConfirmDeliveryAddress').modal('show');
    }

    function createNewCustomer() {
        $('#modalCreateNewCustomer').modal('show');
    }

    function cancelModalConfirmDeliveryAddress() {
        //$('#checkbox_confirm_delivery_address').prop('checked', true);
    }

    function confirmDeliveryAddress() {
        var delivery_first_name = $('#modal_customer_first_name').val();
        var delivery_last_name = $('#modal_customer_last_name').val();
        var delivery_phone_number = $('#modal_customer_phone_number').val();
        var delivery_province = $("#modal_ddlProvince option:selected").text();
        var delivery_district = $("#modal_ddlDistrict option:selected").text();
        var delivery_ward = $("#modal_ddlWard option:selected").text();
        var delivery_address_detail = $('#modal_customer_address_detail').val();

        var delivery_province_id = $("#modal_ddlProvince option:selected").val();
        var delivery_district_id = $("#modal_ddlDistrict option:selected").val();
        var delivery_ward_id = $("#modal_ddlWard option:selected").val();

        $('#text_firstname').text(delivery_first_name);
        $('#text_lastname').text(delivery_last_name);
        $('#text_phone_number').text(delivery_phone_number);
        if (delivery_province_id == -1) {
            $('#text_province').text("");
            $('#text_province_id').text(-1);
        } else {
            $('#text_province').text(delivery_province);
            $('#text_province_id').text(delivery_province_id);
        }
        if (delivery_district_id == -1) {
            $('#text_district').text("");
            $('#text_district_id').text(-1);
        } else {
            $('#text_district').text(delivery_district);
            $('#text_district_id').text(delivery_district_id);
        }
        if (delivery_ward_id == -1) {
            $('#text_ward').text("");
            $('#text_ward_id').text(-1);
        } else {
            $('#text_ward').text(delivery_ward);
            $('#text_ward_id').text(delivery_ward_id);
        }
        $('#text_address_detail').text(delivery_address_detail);

        $('#modalConfirmDeliveryAddress').modal('hide');
    }

    //INSERT CUSTOMER
    function isEmail(email) {
        var regex = /^([a-zA-Z0-9_.+-])+\@@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        return regex.test(email);
    }

    var checkEmail = true;
    $('#modal_create_customer_email').on('change', function () {
        var customer_email = $("#modal_create_customer_email").val().trim();
        if (customer_email != "" && !isEmail(customer_email)) {
            $("#modal_create_customer_email").addClass('is-invalid');
            $("#modal_create_customer_email_feedback").css('display', 'block');
            $("#modal_create_customer_email_feedback").text("Email không hợp lệ.");
        } else {
            $.ajax({
                url: "/Customer/checkDuplicateEmail",
                data: {
                    customer_email: customer_email
                },
                context: document.body,
                type: "POST",
                dataType: "html",
                beforeSend: function () {
                    $('#btn_confirm_create_customer').addClass('buttonload disabled');
                    $('.fa-spin').remove();
                    $('#btn_confirm_create_customer').append('<i class="fa fa-spinner fa-spin"></i>');
                },
                success: function (data) {
                    if (data != "False") {
                        checkEmail = false;
                        $("#modal_create_customer_email").addClass('is-invalid');
                        $("#modal_create_customer_email_feedback").css('display', 'block');
                        $("#modal_create_customer_email_feedback").text("Email đã được sử dụng.");
                    } else {
                        checkEmail = true;
                        $("#modal_create_customer_email").removeClass('is-invalid');
                        $("#modal_create_customer_email_feedback").css('display', 'none');
                    }
                },
                error: function (xhr, status) {
                    $("#valid-feedback").val("Lỗi");
                },
                complete: function (xhr, status) {
                    $('#btn_confirm_create_customer').removeClass('buttonload disabled');
                    $('.fa-spin').remove();
                }
            });
        }

    });

    var checkPhoneNumber = true;
    function checkDupplicatePhoneNumber() {
        var customer_phone_number = $("#modal_create_customer_phone_number").val().trim();
        $.ajax({
            url: "/Customer/checkDuplicatePhoneNumber",
            data: {
                customer_phone_number: customer_phone_number
            },
            context: document.body,
            type: "POST",
            dataType: "html",
            beforeSend: function () {
                $('#btn_confirm_create_customer').addClass('buttonload disabled');
                $('.fa-spin').remove();
                $('#btn_confirm_create_customer').append('<i class="fa fa-spinner fa-spin"></i>');
            },
            success: function (data) {
                if (data != "False") {
                    checkPhoneNumber = false;
                    $("#modal_create_customer_phone_number").addClass('is-invalid');
                    $("#modal_create_customer_phone_number_feedback").css('display', 'block');
                    $("#modal_create_customer_phone_number_feedback").text("Số điện thoại đã được sử dụng.");
                } else {
                    checkPhoneNumber = true;
                    $("#modal_create_customer_phone_number").removeClass('is-invalid');
                    $("#modal_create_customer_phone_number_feedback").css('display', 'none');
                }
            },
            error: function (xhr, status) {
                $("#valid-feedback").val("Lỗi");
            },
            complete: function (xhr, status) {
                $('#btn_confirm_create_customer').removeClass('buttonload disabled');
                $('.fa-spin').remove();
            }
        });
    }

    var checkEmailEditInOrder = true;
    $('#modal_edit_customer_email').on('change', function () {
        var customer_email = $("#modal_edit_customer_email").val().trim();
        if (customer_email != "" && !isEmail(customer_email)) {
            $("#modal_edit_customer_email").addClass('is-invalid');
            $("#modal_edit_customer_email_feedback").css('display', 'block');
            $("#modal_edit_customer_email_feedback").text("Email không hợp lệ.");
        } else {
            $.ajax({
                url: "/Customer/checkDuplicateEmail",
                data: {
                    customer_email: customer_email
                },
                context: document.body,
                type: "POST",
                dataType: "html",
                beforeSend: function () {
                    $('#btn_confirm_edit_email').addClass('buttonload disabled');
                    $('.fa-spin').remove();
                    $('#btn_confirm_edit_email').append('<i class="fa fa-spinner fa-spin"></i>');
                },
                success: function (data) {
                    if (data != "False" && customer_email != email_before_check) {
                        checkEmailEditInOrder = false;
                        $("#modal_edit_customer_email").addClass('is-invalid');
                        $("#modal_edit_customer_email_feedback").css('display', 'block');
                        $("#modal_edit_customer_email_feedback").text("Email đã được sử dụng.");
                    } else {
                        checkEmailEditInOrder = true;
                        $("#modal_edit_customer_email").removeClass('is-invalid');
                        $("#modal_edit_customer_email_feedback").css('display', 'none');
                    }
                },
                error: function (xhr, status) {
                    $("#valid-feedback").val("Lỗi");
                },
                complete: function (xhr, status) {
                    $('#btn_confirm_edit_email').removeClass('buttonload disabled');
                    $('.fa-spin').remove();
                }
            });
        }
    });

    function confirmEditEmail() {
        var customer_email = $("#modal_edit_customer_email").val().trim();
        if (customer_email == "") {
            showToast("error", "Yêu cầu nhập địa chỉ email.", "Lỗi");
            $("#modal_edit_customer_email_feedback").css('display', 'block');
            $("#modal_edit_customer_email_feedback").text("Yêu cầu nhập địa chỉ email.");
        }
        else if (customer_email != "" && !isEmail(customer_email)) {
            showToast("error", "Địa chỉ email không đúng định dạng.", "Lỗi");
            $("#modal_edit_customer_email").addClass('is-invalid');
            $("#modal_edit_customer_email_feedback").css('display', 'block');
            $("#modal_edit_customer_email_feedback").text("Email không hợp lệ.");
        }
        else if (customer_email != "" && checkEmailEditInOrder == false) {
            showToast("error", "Địa chỉ email này thuộc sở hữu khách hàng khác.", "Lỗi");
            $("#modal_edit_customer_email").addClass('is-invalid');
            $("#modal_edit_customer_email_feedback").css('display', 'block');
            $("#modal_edit_customer_email_feedback").text("Email đã được sử dụng.");
        }
        else {
            $('#modal_edit_customer_email').removeClass('is-invalid');
            $("#modal_edit_customer_email_feedback").css('display', 'none');
            $.ajax({
                url: "/Customer/UpdateEmail",
                data: {
                    customer_email: customer_email,
                    customer_id: @Model.customer_id
                },
                context: document.body,
                type: "POST",
                dataType: "html",
                beforeSend: function () {
                    $('#btn_confirm_edit_email').addClass('buttonload disabled');
                    $('.fa-spin').remove();
                    $('#btn_confirm_edit_email').append('<i class="fa fa-spinner fa-spin"></i>');
                },
                success: function (data) {
                    showToast("success", "Email của khách hàng đã được cập nhật.", "Cập nhật thành công");
                    $('#info_customer_email').text(customer_email);
                    $('#modalEditEmail').modal('hide');
                },
                error: function (xhr, status) {
                    showToast("error", "Vui lòng kiểm tra lại dữ liệu vừa nhập.", "Cập nhật thất bại");
                },
                complete: function (xhr, status) {
                    $('#btn_confirm_edit_email').removeClass('buttonload disabled');
                    $('.fa-spin').remove();
                }
            });
        }
    }

    function createCustomer() {
        var firstname = $('#modal_create_customer_first_name').val();
        var lastname = $('#modal_create_customer_last_name').val();
        var phone_number = $("#modal_create_customer_phone_number").val();
        var province_id = $('#modal_create_ddlProvince').val();
        var district_id = $('#modal_create_ddlDistrict').val();
        var ward_id = $('#modal_create_ddlWard').val();
        var address_detail = $('#modal_create_customer_address_detail').val();
        var email = $('#modal_create_customer_email').val();
        var marketing_status = $('#modal_create_status_marketing').is(':checked');

        if (firstname == "" && lastname == "" && email == "") {
            showToast("error", "Khách hàng cần có họ tên hoặc địa chỉ email.", "Lỗi");
            $('#modal_create_customer_first_name').addClass('is-invalid');
            $('#modal_create_customer_last_name').addClass('is-invalid');
            $('#phone_number').addClass('is-invalid');
            $('#modal_create_customer_email').addClass('is-invalid');
        }
        else if (email != "" && !isEmail(email)) {
            showToast("error", "Địa chỉ email không đúng định dạng.", "Lỗi");
            $('#modal_create_customer_first_name').removeClass('is-invalid');
            $('#modal_create_customer_last_name').removeClass('is-invalid');
            $("#modal_create_customer_email_feedback").css('display', 'block');
            $("#modal_create_customer_email").addClass('is-invalid');
            $("#modal_create_customer_email_feedback").text("Email không hợp lệ.");
        }
        else if (email != "" && checkEmail == false) {
            showToast("error", "Địa chỉ email này thuộc sở hữu khách hàng khác.", "Lỗi");
            $('#modal_create_customer_first_name').removeClass('is-invalid');
            $('#modal_create_customer_lastname').removeClass('is-invalid');
            $("#modal_create_customer_email").addClass('is-invalid');
            $("#modal_create_customer_email_feedback").css('display', 'block');
            $("#modal_create_customer_email_feedback").text("Email đã được sử dụng.");
        }
        else if (checkPhoneNumber == false) {
            showToast("error", "Số điện thoại này này thuộc sở hữu khách hàng khác.", "Lỗi");
            $('#modal_create_customer_first_name').removeClass('is-invalid');
            $('#modal_create_customer_lastname').removeClass('is-invalid');
            $("#modal_create_customer_phone_number").addClass('is-invalid');
            $("#modal_create_customer_phone_number_feedback").css('display', 'block');
            $("#modal_create_customer_phone_number_feedback").text("Số điện thoại đã được sử dụng.");
        }
        else {
            $('#modal_create_customer_first_name').removeClass('is-invalid');
            $('#modal_create_customer_lastname').removeClass('is-invalid');
            $('#modal_create_customer_phone_number').removeClass('is-invalid');
            $('#modal_create_customer_email').removeClass('is-invalid');
            $("#modal_create_customer_phone_number_feedback").css('display', 'none');
            $.ajax({
                url: "/Customer/InsertCustomerInOrder",
                data: {
                    first_name: firstname,
                    last_name: lastname,
                    customer_phone_number: phone_number,
                    customer_email: email,
                    address_detail: address_detail,
                    province_id: province_id,
                    district_id: district_id,
                    ward_id: ward_id,
                    marketing_status: marketing_status
                },
                context: document.body,
                type: "POST",
                dataType: "html",
                beforeSend: function () {
                    $('#btn_confirm_create_customer').addClass('buttonload disabled');
                    $('.fa-spin').remove();
                    $('#btn_confirm_create_customer').append('<i class="fa fa-spinner fa-spin"></i>');
                },
                success: function (data) {
                    var data_json = JSON.parse(data);
                    showToast("success", "Thông tin khách hàng đã được tạo.", "Tạo thành công");
                    $('#modalCreateNewCustomer').modal('hide');
                    selectThisCustomer(data_json.customer_id);
                    delivery_address_id_selected = data_json.delivery_id;
                    email_before_check = email;
                },
                error: function (xhr) {
                    toastError();
                },
                complete: function (xhr, status) {
                    $('#btn_confirm_create_customer').removeClass('buttonload disabled');
                    $('.fa-spin').remove();
                }
            });
        }
    }

    $('#modal_create_customer_email').keyup(function () {
        $("#modal_create_customer_email").removeClass('is-invalid');
        $("#modal_create_customer_email_feedback").css('display', 'none');
    });



    //INSERT ORDER
    function isPaid() {
        $('#amount_received').autoNumeric('set', $('#total_in_order').autoNumeric('get'));
        $('#modalConfirmIsPaid').modal('show');
    }

    function isPending() {
        $('#amount_pending').autoNumeric('set', $('#total_in_order').autoNumeric('get'));
        $('#modalConfirmIsPending').modal('show');
    }

    function updateDraftOrder() {
        if (list_new_product_index.length == 0) {
            showToast("error", "Không thể lưu do danh sách sản phẩm trên đơn hàng này đang trống.", "Lỗi");
            $("html, body").animate({ scrollTop: 0 }, 600);
        } else {
            console.log(list_custom_product_id);
            var delivery_address_in_order = {};
            delivery_address_in_order.delivery_address_id = delivery_address_id_selected;
            delivery_address_in_order.first_name = $('#text_firstname').text();
            delivery_address_in_order.last_name = $('#text_lastname').text();
            delivery_address_in_order.phone_number = $('#text_phone_number').text();
            delivery_address_in_order.province_id = $('#text_province_id').text();
            delivery_address_in_order.district_id = $('#text_district_id').text();
            delivery_address_in_order.ward_id = $('#text_ward_id').text();
            delivery_address_in_order.address_detail = $('#text_address_detail').text();
            delivery_address_in_order.customer_id = customer_id_selected;

            var draft_order = {};
            draft_order.order_id = @Model.order_id;
            draft_order.customer_id = customer_id_selected;
            draft_order.order_note = $('#order_note').val();
            draft_order.source_order = $('#select_source_order option:selected').text();
            if (isPromotion == false) {
                draft_order.discount_amount = $('#promotion_value').autoNumeric('get');
                draft_order.reason_of_promotion = $('#text_reason_promotion').text();
            }
            draft_order.name_of_shipping = $('#text_name_of_shipping').text();
            draft_order.cost_of_shipping = $('#ship_price').autoNumeric('get');

            var list_custom_product_in_order = [];
            $.each(list_custom_product_id, function (key, value) {
                var custom_product_in_order = {};
                custom_product_in_order.custom_product_in_order_name = $('.custom_product_name_' + value).text();
                custom_product_in_order.custom_product_in_order_quantity = $('.custom_product_quantity_' + value).val();
                custom_product_in_order.unit_name = $('.custom_product_unit_name_' + value).text();
                custom_product_in_order.custom_product_in_order_price = $('.custom_product_price_' + value).autoNumeric('get');
                list_custom_product_in_order.push(custom_product_in_order);
            });

            var list_quantity_pv = [];
            $.each(list_product_variation_id, function (key, value) {
                var quantity_pv = {};
                quantity_pv.product_variation_id = value;
                quantity_pv.product_variation_quantity = $('#id_input_quantity_' + value).val();
                quantity_pv.unit_name = $('#product_variation_unit_name_' + value).text();
                list_quantity_pv.push(quantity_pv);
            });

            $.ajax({
                url: "/Order/UpdateDraftOrder",
                data: {
                    model: draft_order,
                    list_product_variation_in_order: list_quantity_pv,
                    list_custom_product_in_order: list_custom_product_in_order,
                    delivery_address_in_order: delivery_address_in_order,
                },
                context: document.body,
                type: "POST",
                dataType: "html",
                beforeSend: function () {
                    $('#btn_update_draft_order').addClass('buttonload disabled');
                    $('.fa-spin').remove();
                    $('#btn_update_draft_order').append('<i class="fa fa-spinner fa-spin"></i>');
                },
                success: function (data) {
                    showToast("success", "Đơn hàng nháp đã được cập nhật.", "Cập nhật thành công");
                    data_json = JSON.parse(data);
                    $('#text_header_user_update').text(data_json.user_update);

                    var now_update = new Date();
                    var current_time_upadate = now_update.getHours() + ':' + now_update.getMinutes();
                    if (now_update.getMinutes().toString().length == 1) {
                        current_time_upadate = now_update.getHours() + ':0' + now_update.getMinutes();
                    }
                    $('#text_header_datetime_update').text("Hôm nay " + current_time_upadate);

                },
                error: function (xhr, status) {
                    showToast("error", "Vui lòng kiểm tra lại dữ liệu vừa nhập.", "Lỗi");
                    $("html, body").animate({ scrollTop: 0 }, 600);
                },
                complete: function (xhr, status) {
                    $('#btn_update_draft_order').removeClass('buttonload disabled');
                    $('.fa-spin').remove();
                    $("html, body").animate({ scrollTop: 0 }, 600);
                }
            });
        }
    }
</script>