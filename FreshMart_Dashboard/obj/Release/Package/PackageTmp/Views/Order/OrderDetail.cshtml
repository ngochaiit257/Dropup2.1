@model Data.order
@using Data;
@using Data.Providers;
@{
    ViewBag.Title = "Chi tiết đơn hàng #" + Model.order_id;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@{
    var current_datetime = System.DateTime.Now;

    var da_to_show = new DeliveryAddressProvider().getById((int)Model.delivery_address_id);
}


<div class="row">
    <div class="col-md-12 m-b-30">
        <!-- begin page title -->
        <div class="d-block d-sm-flex flex-nowrap align-items-center">
            <div class="page-title mb-2 mb-sm-0">
                <h1>
                    Đơn hàng #@Model.order_id /
                    <strong>
                        Cập nhật bởi <span class="text-info" id="text_header_user_update">@ViewBag.UsernameUpdate</span>
                        lúc
                        @if (Model.update_datetime.Value.Date == current_datetime.Date)
                        {
                            <span id="text_header_datetime_update">Hôm nay @Model.update_datetime.Value.ToString("HH:mm")</span>
                        }
                        else if (Model.update_datetime.Value.Date == current_datetime.Date.AddDays(1))
                        {
                            <span id="text_header_datetime_update">Ngày mai @Model.update_datetime.Value.ToString("HH:mm")</span>
                        }
                        else if (Model.update_datetime.Value.Date == current_datetime.Date.AddDays(-1))
                        {
                            <span id="text_header_datetime_update">Hôm qua @Model.update_datetime.Value.ToString("HH:mm")</span>
                        }
                        else
                        {
                            <span id="text_header_datetime_update">Ngày @Model.update_datetime.Value.ToString("dd/M/yyyy") @Model.update_datetime.Value.ToString("HH:mm")</span>
                        }

                    </strong>
                </h1>
            </div>
            <div class="ml-auto d-flex align-items-center">
                <nav>
                    <ol class="breadcrumb p-0 m-b-0">
                        <li class="breadcrumb-item">
                            <a href="/Home/Index"><i class="ti ti-home"></i></a>
                        </li>
                        <li class="breadcrumb-item">
                            Đơn hàng
                        </li>
                        <li class="breadcrumb-item active text-primary" aria-current="page">#@Model.order_id</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!-- end page title -->
    </div>
</div>

<div class="row">
    <div class="col-xxl-8">
        <div class="card card-statistics">
            <div class="card-header">
                <div class="card-heading">
                    <h4 class="card-title">Chi tiết đơn hàng</h4>
                </div>
            </div>
            <div class="card-body">

                @*div append*@
                <div id="div_list_product_selected">
                    <div class="div_product_selected">
                        <div class="table-responsive">
                            <table class="table table-borderless mb-0">
                                <thead>
                                    <tr>
                                        <th scope="col" style="width:10%;"></th>
                                        <th scope="col" style="width:35%;">
                                            Tên sản phẩm
                                        </th>
                                        <th scope="col" style="width:15%;">
                                            Giá
                                        </th>
                                        <th scope="col" style="width:15%; text-align:center">
                                            Số lượng
                                        </th>
                                        <th scope="col" style="width:10%;">
                                            Đơn vị
                                        </th>
                                        <th scope="col" style="width:15%;">
                                            Tổng giá từng sản phẩm
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="table_list_product_selected">
                                    @if (ViewData["ListProductVariationInOrder"] != null)
                                    {
                                        foreach (var pv in ViewData["ListProductVariationInOrder"] as List<product_variation_in_order>)
                                        {
                                    <tr id="" class="">
                                        <td scope="row" id="1" class="">
                                            <img src="@pv.product_variation_image" class="img-fluid bg-img img_product_in_order">&nbsp;
                                        </td>
                                        <td style="white-space: unset" id="">
                                            <a target="_blank" href="/Product/ProductDetail?id=@(new ProductProvider().getProductIdByProductVariationId((long)pv.product_variation_id))" class="text-primary font-bold">
                                                @pv.product_name
                                            </a><br>
                                            <small class="text-info">@pv.product_variation_name</small>
                                        </td>
                                        <td id="" class="showNumeric">@pv.product_variation_price</td>
                                        <td align="center">@pv.product_variation_quantity</td>
                                        @if (pv.unit_name == null)
                                        {
                                            <td>(item)</td>
                                        }
                                        else
                                        {
                                            <td>(@pv.unit_name)</td>
                                        }
                                        <td class="showNumeric" id="">@(pv.product_variation_price * pv.product_variation_quantity)</td>
                                    </tr>
                                        }
                                    }
                                    @if (ViewData["ListCustomProductInOrder"] != null)
                                    {
                                        foreach (var cp in ViewData["ListCustomProductInOrder"] as List<custom_product_in_order>)
                                        {
                                            <tr id="" class="">
                                                <td scope="row" id="1" class="">
                                                    <img src="../Assets/images/Icon/iconImg.png" style="background-color: #ccc" class="img-fluid bg-img img_product_in_order">&nbsp;
                                                </td>
                                                <td style="white-space: unset" id="">
                                                    <a class="text-primary font-bold">
                                                        @cp.custom_product_in_order_name
                                                    </a><br>
                                                </td>
                                                <td id="" class="showNumeric">@cp.custom_product_in_order_price</td>
                                                <td align="center">@cp.custom_product_in_order_quantity</td>
                                                <td>(@cp.unit_name)</td>
                                                <td class="showNumeric" id="">@(cp.custom_product_in_order_quantity * cp.custom_product_in_order_price)</td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="row" id="div_info_detail_order">
                    <div class="col-md-5">
                        <form>
                            <div class="form-group">
                                <label class="control-label" for="order_note">Ghi chú</label>
                                <div class="mb-2">
                                    <textarea class="form-control" placeholder="Ghi chú đơn hàng" id="order_note" name="order_note" rows="3">@Model.order_note</textarea>
                                </div>
                            </div>
                        </form>
                        <a href="javascript:void(0);" class="btn btn-primary">Lưu ghi chú</a>
                    </div>
                    <div class="col-md-7">
                        <label class="control-label" for="product_description">Hóa đơn bao gồm</label>
                        <div class="table-responsive">
                            <table class="table mb-0" id="table_cost_order">
                                <thead style="display: none">
                                    <tr>
                                        <th style="width: 40%"></th>
                                        <th style="width: 20%"></th>
                                        <th style="width: 40%"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Tổng giá trị các sản phẩm</td>
                                        <td id="sum_in_all_product" class="showNumeric">@ViewBag.TotalPriceAllProduct</td>
                                    </tr>
                                    <tr>
                                        <td id="label_promotion">
                                            Khuyến mãi / Ưu đãi <br />
                                            <div id="label_small_reason_promotion">
                                                <small class="text-info" id="text_reason_promotion">@Model.reason_of_promotion</small>
                                            </div>
                                        </td>
                                        <td id="promotion_value" class="showNumeric">@Model.discount_amount</td>
                                    </tr>
                                    <tr>
                                        <td id="label_shipping_price">
                                            Chi phí vận chuyển <br />
                                            <div id="label_small_name_of_shipping">
                                                <small class="text-info" id="text_name_of_shipping">@Model.name_of_shipping</small>
                                            </div>
                                        </td>
                                        <td id="ship_price" class="showNumeric">@Model.cost_of_shipping</td>
                                    </tr>
                                    <tr>
                                        <td class="font-weight-bold text-danger">
                                            Số tiền phải thanh toán <br />
                                            <div id="label_small_payment_method">
                                                <small class="text-info" id="text_payment_method">@Model.payment_method.payment_method_description</small>
                                            </div>
                                        </td>
                                        <td class="font-weight-bold text-danger showNumeric" id="total_in_order">@ViewBag.TotalCostOfOrder</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>

                <div class="line_div"></div>
                @if (Model.confirm_order_status == false)
                {
                    <div class="row">
                        <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6 label_div_btn_left" id="div_confirm_order">
                            <a class="font-18 text-secondary"><i class="fe fe-check-square"></i></a> &nbsp;
                            <label class=""> XÁC THỰC ĐƠN HÀNG </label>
                        </div>
                        <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6 div_btn_right">
                            <a href="javascript:void(0);" class="btn btn-primary" id="btn_confirm_order" onclick="openModalConfirmOrder()">Xác thực</a>
                        </div>
                    </div>
                }
                else
                {
                    <div class="row">
                        <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6 label_div_btn_left">
                            <a class="font-18 text-success"><i class="fe fe-check-square"></i></a> &nbsp;
                            <label class=""> ĐÃ XÁC THỰC ĐƠN HÀNG </label>
                        </div>
                        <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6 div_btn_right"></div>
                    </div>
                }

                <div class="line_div"></div>

                @if (Model.payment_status == false)
                {
                    <div class="row">
                        <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6 label_div_btn_left" id="div_confirm_payment">
                            <a class="font-18 text-secondary" id="icon_confirm_payment"><i class="fe fe-credit-card"></i></a> &nbsp;
                            <label id="text_confirm_payment"> THANH TOÁN ĐANG CHỜ XỬ LÝ </label>
                        </div>
                        <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6 div_btn_right">
                            <a href="javascript:void(0);" class="btn btn-primary" id="btn_confirm_payment" onclick="openModalConfirmPayment()">Xác nhận thanh toán</a>
                            <a href="javascript:void(0);" class="btn btn-secondary" id="btn_repay" onclick="repay()">Hoàn trả</a>
                        </div>
                    </div>
                }
                else
                {
                    <div class="row">
                        <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6 label_div_btn_left">
                            <a class="font-18 text-success"><i class="fe fe-check-square"></i></a> &nbsp;
                            <label class=""> THANH TOÁN <span class="showNumeric font-bold text-info">@ViewBag.TotalCostOfOrder</span> ĐƯỢC CHẤP NHẬN</label>
                        </div>
                        <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6 div_btn_right">
                            <a href="javascript:void(0);" class="btn btn-secondary" id="btn_repay" onclick="repay()">Hoàn trả</a>
                        </div>
                    </div>
                }

                <div class="line_div"></div>

                @if (ViewBag.Transport == null)
                {
                    <div id="div_has_not_transport">
                        <div class="row">
                            <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6  label_div_btn_left">
                                <a class="font-18 text-secondary"><i class="fa fa-truck"></i></a> &nbsp;
                                <label class=""> GIAO HÀNG </label>
                            </div>
                            <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6 div_btn_right">
                                <a href="javascript:void(0);" class="btn btn-primary" id="btn_open_div_create_transport" onclick="openDivCreateTransport()">Giao hàng</a>
                                <a onclick="closeDivCreateTransport()" id="icon_cancel_div_create_transport" data-toggle="tooltip" data-placement="top" data-original-title="Hủy giao hàng" href="javascript:void(0);" class="tooltip-wrapper text-primary font-25 hidden_element"><i class="fa fa-times-circle"></i></a>
                            </div>
                        </div>
                        <div class="div_under hidden_element" id="div_create_transport">
                            <form>
                                <div class="row">
                                    <div class="col-md-4 col-lg-4 col-sm-12">
                                        <div class="form-group">
                                            <label class="control-label" for="">Kho lấy hàng</label>
                                            <select class="custom-select input_select_border" id="warehouse_to_get">
                                                <option value="" selected>Địa điểm mặc định</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-4 col-lg-4 col-sm-12">
                                        <label class="control-label" for="">Khối lượng gói hàng</label>
                                        <div class="mb-2">
                                            <input type="number" min="0" class="form-control" placeholder="Nhập khối lượng" id="package_weight">
                                            <div class="invalid-feedback" id="new_product_price_input_feedback">
                                                Khối lượng không hợp lệ
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 col-lg-4 col-sm-12">
                                        <div class="form-group">
                                            <label class="control-label" for="">Hình thức vận chuyển</label>
                                            <select class="custom-select input_select_border" id="transport_method">
                                                <option value="" selected>Đường bộ</option>
                                                <option value="">Đường bay</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="control-label" for="">Địa chỉ giao hàng</label>
                                    <div class="alert alert-outline-info" role="alert">
                                        <div class="row">
                                            <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6 label_div_btn_left">
                                                <div class="table-responsive" id="">
                                                    <table class="table table-borderless mb-0">
                                                        <tbody>
                                                            <tr>
                                                                <td class="font-bold" width="30%">Người nhận:</td>
                                                                @if (da_to_show.last_name != null)
                                                                {
                                                                    <td class="unset_white_space" width="70%">@da_to_show.first_name @da_to_show.last_name</td>
                                                                }
                                                                else
                                                                {
                                                                    <td class="unset_white_space" width="70%">
                                                                        <span class="mr-2 mb-2 mr-sm-0 mb-sm-0 badge badge-secondary-inverse">Chưa có</span>
                                                                    </td>
                                                                }
                                                            </tr>
                                                            <tr>
                                                                <td class="font-bold">Điện thoại:</td>
                                                                @if (da_to_show.phone_number != null)
                                                                {
                                                                    <td class="unset_white_space" width="70%">@da_to_show.phone_number</td>
                                                                }
                                                                else
                                                                {
                                                                    <td class="unset_white_space" width="70%">
                                                                        <span class="mr-2 mb-2 mr-sm-0 mb-sm-0 badge badge-secondary-inverse">Chưa có</span>
                                                                    </td>
                                                                }

                                                            </tr>
                                                            <tr>
                                                                <td class="font-bold">Địa chỉ:</td>
                                                                @if (da_to_show.address_detail != null)
                                                                {
                                                                    <td class="unset_white_space" width="70%">@da_to_show.address_detail</td>
                                                                }
                                                                else
                                                                {
                                                                    <td class="unset_white_space" width="70%">
                                                                        <span class="mr-2 mb-2 mr-sm-0 mb-sm-0 badge badge-secondary-inverse">Chưa có</span>
                                                                    </td>
                                                                }
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6" id="">
                                                <div class="table-responsive" id="">
                                                    <table class="table table-borderless mb-0">
                                                        <tbody>
                                                            <tr>
                                                                <td class="font-bold" width="30%">Xã/Phường/Thị trấn:</td>
                                                                @if (da_to_show.ward_id == null)
                                                                {
                                                                    <td class="unset_white_space" width="70%">
                                                                        <span class="mr-2 mb-2 mr-sm-0 mb-sm-0 badge badge-secondary-inverse">Chưa có</span>
                                                                    </td>
                                                                }
                                                                else
                                                                {
                                                                    <td class="unset_white_space" width="70%">@da_to_show.ward.Type @da_to_show.ward.Name</td>
                                                                }
                                                            </tr>
                                                            <tr>
                                                                <td class="font-bold">Quận/Huyện/Thị xã:</td>
                                                                @if (da_to_show.district_id != null)
                                                                {
                                                                    <td class="unset_white_space" width="70%">@da_to_show.district.Type @da_to_show.district.Name</td>
                                                                }
                                                                else
                                                                {
                                                                    <td class="unset_white_space" width="70%">
                                                                        <span class="mr-2 mb-2 mr-sm-0 mb-sm-0 badge badge-secondary-inverse">Chưa có</span>
                                                                    </td>
                                                                }
                                                            </tr>
                                                            <tr>
                                                                <td class="font-bold">Tỉnh/Thành phố:</td>
                                                                @if (da_to_show.province_id != null)
                                                                {
                                                                    <td class="unset_white_space" width="70%">@da_to_show.province.Type @da_to_show.province.Name</td>
                                                                }
                                                                else
                                                                {
                                                                    <td class="unset_white_space" width="70%">
                                                                        <span class="mr-2 mb-2 mr-sm-0 mb-sm-0 badge badge-secondary-inverse">Chưa có</span>
                                                                    </td>
                                                                }
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="" style="padding-top: 10px;">
                                    <div class="row">
                                        <div class="col-md-8 col-lg-8 col-sm-12">
                                            <div class="form-group">
                                                <label class="control-label" for="">Dịch vụ giao hàng</label>
                                                <select class="custom-select input_select_border" id="transport_service">
                                                    <option value="" selected>Mặc định</option>
                                                    <option value="">Viettel Post</option>
                                                    <option value="">Ninja Van</option>
                                                    <option value="">Giao hàng nhanh</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-4 col-lg-4 col-sm-12">
                                            @if (Model.payment_method_id == 3)
                                            {
                                                <label class="control-label" for="">Số tiền thu hộ (COD)</label>
                                                <div class="mb-2">
                                                    <input type="text" class="form-control autoNumericInput" placeholder="Nhập khối lượng" value="@ViewBag.TotalCostOfOrder" id="get_cost_cod">
                                                    <div class="invalid-feedback" id="get_cost_cod_feedback">
                                                        Giá trị không hợp lệ.
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" value="true" type="checkbox" name="allow_check_product" id="allow_check_product" style="border: 1px solid #dee2e6;">
                                    <label class="form-check-label" for="allow_check_product">Cho phép xem hàng trước khi nhận</label>
                                </div>
                                <div class="row">
                                    <div class="col-md-4 col-lg-4 col-sm-12">
                                        <div class="form-group">
                                            <label class="control-label" for="package_lenght">Chiều dài gói hàng (cm)</label>
                                            <div class="mb-2">
                                                <input type="number" min="0" class="form-control" placeholder="Chiều dài" id="package_lenght" value="0">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 col-lg-4 col-sm-12">
                                        <label class="control-label" for="package_width">Chiều rộng gói hàng (cm)</label>
                                        <div class="mb-2">
                                            <div class="mb-2">
                                                <input type="number" min="0" class="form-control" placeholder="Chiều rộng" id="package_width" value="0">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 col-lg-4 col-sm-12">
                                        <div class="form-group">
                                            <label class="control-label" for="package_height">Chiều cao gói hàng (cm)</label>
                                            <div class="mb-2">
                                                <input type="number" min="0" class="form-control" placeholder="Chiều cao" id="package_height" value="0">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-8 col-lg-8 col-sm-12">
                                        <label class="control-label" for="transport_description">Ghi chú vận chuyển</label>
                                        <div class="mb-2">
                                            <input type="text" class="form-control" placeholder="Thêm ghi chú khi vận chuyển" id="transport_description">
                                        </div>
                                        <small>VD: Hàng dễ vỡ, Tránh va đập,...</small>
                                    </div>
                                    <div class="col-md-4 col-lg-4 col-sm-12">
                                        <label class="control-label" for="waybill_code">Mã vận đơn</label>
                                        <div class="mb-2">
                                            <input type="text" class="form-control" placeholder="Tự nhập mã vận đơn" id="waybill_code">
                                        </div>
                                    </div>
                                </div>
                                <div class="line_div"></div>
                                <div class="row">
                                    <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6 label_div_btn_left">
                                        <div class="form-check">
                                            <input checked class="form-check-input" type="checkbox" name="checkbox_send_email_transport" id="checkbox_send_email_transport" style="border: 1px solid #dee2e6;">
                                            <label class="form-check-label" for="checkbox_send_email_transport">Gửi email xác nhận vận chuyển cho khách hàng</label>
                                        </div>
                                    </div>
                                    <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6 div_btn_right">
                                        <a href="javascript:void(0);" class="btn btn-secondary" id="" onclick="closeDivCreateTransport()">Hủy</a>
                                        <a href="javascript:void(0);" class="btn btn-primary" id="btn_create_transport" onclick="createTransport()">Xác nhận giao hàng</a>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div id="div_has_transport" class="hidden_element">
                        <div class="row">
                            <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6 label_div_btn_left">
                                <a class="font-18 text-success"><i class="fe fe-check-square"></i></a> &nbsp;
                                <label class=""> TẤT CẢ SẢN PHẨM ĐÃ ĐƯỢC CHUYỂN GIAO</label>
                            </div>
                            <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6 div_btn_right">
                                <a>MÃ VẬN CHUYỂN: </a>
                                <a data-toggle="tooltip" data-placement="top" data-original-title="Chuyển đến chi tiết vận chuyển" href="javascript:void(0);" class="tooltip-wrapper text-primary font-bold" id="transport_code_text"></a>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6 label_div_btn_left">

                            </div>
                            <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6 div_btn_right">
                                <h4>
                                    <span class="badge badge-info-inverse px-2 py-1 mt-1">
                                        <i class="zmdi zmdi-truck"></i>&nbsp;&nbsp;
                                        <span>
                                            Đang chờ lấy
                                        </span>
                                    </span>
                                </h4>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6 label_div_btn_left">
                                <div class="table-responsive" id="">
                                    <table class="table table-borderless mb-0">
                                        <tbody>
                                            <tr>
                                                <td class="font-bold" width="30%">Dịch vụ giao hàng:</td>
                                                <td id="transport_service_text" width="70%"></td>
                                            </tr>
                                            <tr>
                                                <td class="font-bold">Địa điểm lấy hàng:</td>
                                                <td id="warehouse_to_get_text"></td>
                                            </tr>
                                            <tr>
                                                <td class="font-bold">Mã vận đơn:</td>
                                                <td id="waybill_code_text"></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6" id="">
                                <div class="table-responsive" id="">
                                    <table class="table table-borderless mb-0">
                                        <tbody>
                                            <tr>
                                                <td class="font-bold" width="30%">Tổng khối lượng (kg):</td>
                                                <td id="package_weight_text" width="70%"></td>
                                            </tr>
                                            <tr>
                                                <td class="font-bold">Dài x Rộng x Cao (cm):</td>
                                                <td id="package_size_text"></td>
                                            </tr>
                                            <tr>
                                                <td class="font-bold">Số tiền thu hộ (COD):</td>
                                                <td id="get_cost_cod_text" class="showNumeric"></td>
                                                <td id="not_get_cod" class="hidden_element">
                                                    <span class="mr-2 mb-2 mr-sm-0 mb-sm-0 badge badge-secondary-inverse">Không thu</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="line_div"></div>
                        <div class="row">
                            <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6 label_div_btn_left">
                                <a href="javascript:void(0);" class="btn btn-secondary" onclick="cancelTransport()">Hủy giao hàng</a>
                            </div>
                            <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6 div_btn_right">
                                <a href="javascript:void(0);" class="btn btn-primary" onclick="updateWaybillCode()">Cập nhật mã vận đơn</a>
                                <a id="btn_print_invoice" href="javascript:void(0);" class="btn btn-info"><i class="fa fa-print"></i>&nbsp;&nbsp; In vận đơn</a>
                            </div>
                        </div>
                    </div>
                }
                else
                {
                    <div id="div_has_transport">
                        <div class="row">
                            <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6 label_div_btn_left">
                                <a class="font-18 text-success"><i class="fe fe-check-square"></i></a> &nbsp;
                                <label class=""> TẤT CẢ SẢN PHẨM ĐÃ ĐƯỢC CHUYỂN GIAO</label>
                            </div>
                            <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6 div_btn_right">
                                <a>MÃ VẬN CHUYỂN: </a>
                                <a data-toggle="tooltip" data-placement="top" data-original-title="Chuyển đến chi tiết vận chuyển" href="/Transport/TransportDetail?id=@ViewBag.Transport.transport_id" class="tooltip-wrapper text-primary font-bold">
                                    <span>#T</span>@ViewBag.Transport.transport_id
                                </a>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6 label_div_btn_left">

                            </div>
                            <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6 div_btn_right">
                                <h4>
                                    @if (ViewBag.Transport.shipping_status_id == 1 || ViewBag.Transport.shipping_status_id == 2)
                                    {
                                        <span class="badge badge-info-inverse px-2 py-1 mt-1">
                                            <i class="zmdi zmdi-truck"></i>&nbsp;&nbsp;
                                            <span>
                                                @ViewBag.Transport.shipping_status.shipping_status_description
                                            </span>
                                        </span>
                                    }
                                    else if (ViewBag.Transport.shipping_status_id == 3)
                                    {
                                        <span class="badge badge-success-inverse px-2 py-1 mt-1">
                                            <i class="zmdi zmdi-truck"></i>&nbsp;&nbsp;
                                            <span>
                                                @ViewBag.Transport.shipping_status.shipping_status_description
                                            </span>
                                        </span>
                                    }
                                    else if (ViewBag.Transport.shipping_status_id == 4 || ViewBag.Transport.shipping_status_id == 5)
                                    {
                                        <span class="badge badge-warning-inverse px-2 py-1 mt-1">
                                            <i class="zmdi zmdi-truck"></i>&nbsp;&nbsp;
                                            <span>
                                                @ViewBag.Transport.shipping_status.shipping_status_description
                                            </span>
                                        </span>
                                    }
                                    else
                                    {
                                        <span class="badge badge-danger-inverse px-2 py-1 mt-1">
                                            <i class="zmdi zmdi-truck"></i>&nbsp;&nbsp;
                                            <span>
                                                @ViewBag.Transport.shipping_status.shipping_status_description
                                            </span>
                                        </span>
                                    }

                                </h4>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6 label_div_btn_left">
                                <div class="table-responsive" id="">
                                    <table class="table table-borderless mb-0">
                                        <tbody>
                                            <tr>
                                                <td class="font-bold" width="30%">Dịch vụ giao hàng:</td>
                                                <td width="70%">@ViewBag.Transport.transport_service</td>
                                            </tr>
                                            <tr>
                                                <td class="font-bold">Địa điểm lấy hàng:</td>
                                                <td id="text_phone_number">@ViewBag.Transport.warehouse_to_get</td>
                                            </tr>
                                            <tr>
                                                <td class="font-bold">Mã vận đơn:</td>
                                                <td id="text_province">@ViewBag.Transport.waybill_code</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6" id="">
                                <div class="table-responsive" id="">
                                    <table class="table table-borderless mb-0">
                                        <tbody>
                                            <tr>
                                                <td class="font-bold" width="30%">Tổng khối lượng (kg):</td>
                                                <td width="70%">@ViewBag.Transport.package_weight</td>
                                            </tr>
                                            <tr>
                                                <td class="font-bold">Dài x Rộng x Cao (cm):</td>
                                                <td id="text_phone_number">@ViewBag.Transport.package_lenght x @ViewBag.Transport.package_width x @ViewBag.Transport.package_height</td>
                                            </tr>
                                            <tr>
                                                <td class="font-bold">Số tiền thu hộ (COD):</td>
                                                @if (ViewBag.Transport.order.payment_method_id == 3)
                                                {
                                                    <td id="" class="showNumeric">@ViewBag.Transport.get_cost_cod</td>
                                                }
                                                else
                                                {
                                                    <td id="not_get_cod" class="">
                                                        <span class="mr-2 mb-2 mr-sm-0 mb-sm-0 badge badge-secondary-inverse">Không thu</span>
                                                    </td>
                                                }
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="line_div"></div>
                        <div class="row">
                            <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6 label_div_btn_left">
                                <a href="javascript:void(0);" class="btn btn-secondary" id="">Hủy giao hàng</a>
                            </div>
                            <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6 div_btn_right">
                                <a href="javascript:void(0);" class="btn btn-primary" id="">Cập nhật mã vận đơn</a>
                                <a href="javascript:void(0);" class="btn btn-info" id="btn_print_invoice"><i class="fa fa-print"></i>&nbsp;&nbsp; In vận đơn</a>
                            </div>
                        </div>
                    </div>

                }
            </div>
        </div>

        <div class="event-list-calendar">
            <div class="fc fc-unthemed fc-ltr">
                <div class="fc-toolbar fc-header-toolbar">
                    <div class="fc-center"><h4>NHẬT KÝ ĐƠN HÀNG</h4></div>
                </div>
                <div class="app-chat-type">
                    <div class="input-group mb-0 ">
                        <a data-toggle="tooltip" data-placement="top" data-original-title="Thêm biểu tượng cảm xúc" href="javascript:void(0)" class="tooltip-wrapper input-group-prepend d-none d-sm-flex">
                            <span class="input-group-text">
                                <i class="fa fa-smile-o"></i>
                            </span>
                        </a>
                        <input id="content_add_order_log" class="form-control" placeholder="Thêm nhật ký cho đơn hàng..." type="text">
                        <a onclick="addNewOrderLog()" data-toggle="tooltip" data-placement="top" data-original-title="Lưu lại" href="javascript:void(0)" class="tooltip-wrapper input-group-prepend">
                            <span class="input-group-text">
                                <i class="fa fa-pencil"></i>
                            </span>
                        </a>
                    </div>
                </div>
                <div id="data_order_log">
                    @Html.Action("GetOrderLog", "Order", new { order_id = Model.order_id })
                </div>

            </div>
        </div>
    </div>

    <div class="col-xxl-4">
        <div class="">
            <div class="card mb-0 o-hidden">
                <div class="card-header">
                    <div class="card-heading">
                        <div class="row">
                            <div class="col-md-8">
                                <h4 class="card-title">Thông tin khách hàng</h4>
                            </div>
                            <div class="col-md-4 div-card-title-right">

                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-body selects-contant-boots" id="column_right_select_customer">
                    @if (ViewBag.Customer == null)
                    {
                        <div id="div_customer_null">
                            <img class="img_column_right" src="~/Assets/images/image_system/order_img1.png" />
                            <h5>Chưa có khách hàng nào được chọn</h5>
                        </div>
                    }
                    else
                    {
                        <div class="contact-contant" id="div_contact_customer_selected">
                            <div class="py-4">
                                <div class="d-flex align-items-center">
                                    <div class="bg-img avatar_profile_customer">
                                        <img src="~/Assets/img/avatar/AvatarCustomerProfile.png" class="img-fluid" />
                                    </div>
                                    <div class="ml-3">
                                        <h4 class="mb-0">
                                            @if (ViewBag.Customer.customer_first_name == null && ViewBag.Customer.customer_last_name == null)
                                            {
                                                <a target="_blank" href="/Customer/CustomerDetail?id=@ViewBag.Customer.customer_id" class="text-primary" id="info_customer_fullname">
                                                    @ViewBag.Customer.customer_email
                                                </a>
                                            }
                                            else
                                            {
                                                <a target="_blank" href="/Customer/CustomerDetail?id=@ViewBag.Customer.customer_id" class="text-primary" id="info_customer_fullname">
                                                    @ViewBag.Customer.customer_first_name @ViewBag.Customer.customer_last_name
                                                </a>
                                            }
                                        </h4>
                                        <h4><span class="badge badge-info-inverse px-2 py-1 mt-1"><i class="fa fa-bookmark"></i>&nbsp;&nbsp; <span><a id="info_number_of_order">@ViewBag.NumberOfOrderCustomer</a> đơn hàng</span></span></h4>
                                    </div>
                                </div>
                                <div>
                                    <div class="row">
                                        <div class="col-md-8">
                                            <ul class="nav">
                                                <li class="nav-item">
                                                    <div class="img-icon"><i class="fa fa-envelope-o"></i></div>
                                                </li>
                                                <li class="nav-item">
                                                    <a id="info_customer_email">@ViewBag.Customer.customer_email</a>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="col-md-4" id="div_icon_edit_email_in_order">
                                            <a onclick="editEmailInOrder()" class="tooltip-wrapper card-title text-primary" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Sửa Email" href="javascript:void(0)" id=""><i class="icon_nav fa fa-edit"></i></a>
                                        </div>
                                    </div>

                                    <ul class="nav">
                                        <li class="nav-item">
                                            <div class="img-icon"><i class="fa fa-phone"></i></div>
                                        </li>
                                        <li class="nav-item">
                                            <a id="info_customer_phone_number">@ViewBag.Customer.customer_phone_number</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    }

                </div>
            </div>
        </div>

        <div class="cardRightBottom" id="card_delivery_address">
            <div class="card mb-0 o-hidden">
                <div class="card-header">
                    <div class="card-heading">
                        <div class="row">
                            <div class="col-md-8">
                                <h4 class="card-title">Địa chỉ giao hàng</h4>
                            </div>
                            <div class="col-md-4 div-card-title-right">
                                <a onclick="editDeliveryAddress()" href="javascript:void(0);" class="btn btn-icon btn-xs btn-inverse-primary" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Sửa địa chỉ giao hàng"><i class="fa fa-edit"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-body selects-contant-boots">
                    @if (da_to_show != null)
                    {
                        <div class="table-responsive" id="table_delivery_address">
                            <table class="table table-borderless mb-0">
                                <tbody>
                                    <tr>
                                        <td class="font-bold">Họ Tên:</td>
                                        <td><span id="text_firstname">@da_to_show.first_name</span> <span id="text_lastname">@da_to_show.last_name</span></td>
                                    </tr>
                                    <tr>
                                        <td class="font-bold">Điện thoại:</td>
                                        <td id="text_phone_number">@da_to_show.phone_number</td>
                                    </tr>
                                    <tr>
                                        <td class="font-bold">Tỉnh/Thành phố:</td>
                                        @if (da_to_show.province_id != null)
                                        {
                                            <td id="text_province">@da_to_show.province.Name</td>
                                            <td id="text_province_id" class="hidden_element">@da_to_show.province_id</td>
                                        }
                                        else
                                        {
                                            <td id="text_province"></td>
                                            <td id="text_province_id" class="hidden_element"></td>
                                        }
                                    </tr>
                                    <tr>
                                        <td class="font-bold">Quận/Huyện/Thị xã:</td>
                                        @if (da_to_show.district_id != null)
                                        {
                                            <td id="text_district">@da_to_show.district.Name</td>
                                            <td id="text_district_id" class="hidden_element">@da_to_show.district_id</td>
                                        }
                                        else
                                        {
                                            <td id="text_district"></td>
                                            <td id="text_district_id" class="hidden_element"></td>
                                        }
                                    </tr>
                                    <tr>
                                        <td class="font-bold">Xã/Phường/Thị trấn:</td>
                                        @if (da_to_show.ward_id != null)
                                        {
                                            <td id="text_ward">@da_to_show.ward.Name</td>
                                            <td id="text_ward_id" class="hidden_element">@da_to_show.ward_id</td>
                                        }
                                        else
                                        {
                                            <td id="text_ward"></td>
                                            <td id="text_ward_id" class="hidden_element"></td>
                                        }
                                    </tr>
                                    <tr>
                                        <td class="font-bold">Địa chỉ chi tiết:</td>
                                        <td id="text_address_detail">@da_to_show.address_detail</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <p>Chưa có thông tin</p>
                    }
                </div>
            </div>
        </div>

        <div class="cardRightBottom">
            <div class="card mb-0 o-hidden">
                <div class="card-header">
                    <div class="card-heading">
                        <h4 class="card-title">Tags</h4>
                    </div>
                </div>
                <div class="card-body selects-contant-boots">
                    <div class="form-group mb-0 bs-select-1">
                        <input type="text" class="bs-input" value="" placeholder="Đã duyệt, chờ lấy hàng, đã giao,..." data-role="tagsinput" />
                    </div>
                    <div class="pull-right" id="btn_save_tags">
                        <a href="javascript:void(0);" class="btn btn-primary">Lưu tags</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="cardRightBottom">
            <div class="card mb-0 o-hidden">
                <div class="card-header">
                    <div class="card-heading">
                        <h4 class="card-title">Thông tin ngoài lề</h4>
                    </div>
                </div>
                <div class="card-body selects-contant-boots">
                    <div class="table-responsive" id="table_delivery_address">
                        <table class="table table-borderless mb-0">
                            <tbody>
                                <tr>
                                    <td class="font-bold" width="30%"><i class="fe fe-repeat"></i>&nbsp;&nbsp; Kênh bán:</td>
                                    <td class="text-info" width="70%">@Model.source_order</td>
                                </tr>
                                <tr>
                                    <td class="font-bold"><i class="fe fe-user"></i>&nbsp;&nbsp; Người tạo:</td>
                                    <td class="text-info">@Model.user.username</td>
                                </tr>
                                <tr>
                                    <td class="font-bold"><i class="fe fe-home"></i>&nbsp;&nbsp; Kho bán:</td>
                                    <td class="text-info">Địa điểm mặc định</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<div class="">
    <div class="line_div"></div>
    <a href="javascript:void(0);" onclick="showModalDeleteThisOrder()" class="btn btn-secondary" id="">Xóa đơn hàng</a>
</div>

<div id="invoice_content" class="hidden_element" style="font-family:Arial,Helvetica,sans-serif">
    @*@{Html.RenderPartial("_PartialViewInvoice", Model);}*@
</div>

<div class="modal fade hide in" data-keyboard="false" data-backdrop="static" id="modalConfirmOrder" tabindex="-1" role="dialog" aria-labelledby="defaultModal" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Xác thực đơn hàng</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <label>Bạn có chắc chắn xác thực đơn hàng này?</label><br />
                <div>
                    <a>
                        Đơn hàng sẽ được tiếp nhận sau khi xác thực thành công.
                    </a>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-success" onclick="confirmOrder('@Model.order_id')">Xác nhận</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade hide in" data-keyboard="false" data-backdrop="static" id="modalConfirmPayment" tabindex="-1" role="dialog" aria-labelledby="defaultModal" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Xác nhận thanh toán</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <label>Bạn có chắc chắn xác nhận đơn hàng này đã được thanh toán?</label><br />
                <div>
                    <a>
                        Hình thức thanh toán của đơn hàng là <strong>@Model.payment_method.payment_method_description</strong> <br />
                        Sau khi xác nhận đơn hàng đã được thanh toán, bạn không thể thay đổi phương thức hoặc trạng thái thanh toán. <br />
                        Lưu ý: <i>Hệ thống sẽ chỉ lưu lại xác nhận thanh toán và tổng số tiền phải thanh toán của đơn hàng này.</i>
                    </a>
                </div>
                <div class="line_div"></div>
                <div>
                    <a>Xác nhận số tiền đã nhận được: <span class="font-bold showNumeric" id="show_cost_of_order_in_modal">@ViewBag.TotalCostOfOrder</span></a>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-success" onclick="confirmPayment('@Model.order_id')">Xác nhận</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade hide in" data-keyboard="false" data-backdrop="static" id="modalUpdateWaybillCode" tabindex="-1" role="dialog" aria-labelledby="defaultModal" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Cập nhật mã vận đơn</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label class="control-label" for="product_price_promotion">Mã vận đơn</label>
                        <div class="mb-2">
                            <input value="" type="text" class="form-control" id="waybill_code" name="waybill_code" placeholder="Nhập mã vận đơn">
                            <div class="invalid-feedback" id="waybill_code_feedback">
                                Yêu cầu nhập mã vận đơn.
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-success" onclick="confirmUpdateWaybillCode()">Cập nhật</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" data-keyboard="false" data-backdrop="static" id="modalConfirmDeleteOrder" tabindex="-1" role="dialog" aria-labelledby="defaultModal" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    Bạn chắc chắn muốn xóa đơn hàng này?
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <a>
                    Thao tác này sẽ xóa đơn hàng bạn đã chọn. Các sản phẩm trên đơn hàng sẽ không được cập nhật lại số lượng.
                </a>
                <a>
                    Thao tác này không thể khôi phục.
                </a>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-warning" data-dismiss="modal" onclick="deleteOrder('@Model.order_id')">Xóa</button>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#order').addClass('active');

        $('form').trigger('reset');

        if (Cookies.get("insert_order_success") != null) {
            showToast("success", 'Đơn hàng <strong>#' + Cookies.get('insert_order_success') + '</strong> đã được tạo.', "Tạo thành công");
            Cookies.remove('insert_order_success');
        }

        delivery_address_id_selected = @Model.delivery_address_id;
    });

    $('#btn_print_invoice').on('click', function () {
        $.ajax({
            url: '/Order/PrintInvoice',
            type: 'POST',
            data: {
                order_id: @Model.order_id,
            },
            context: document.body,
            type: "POST",
            dataType: "html",
            success: function (data) {
                $('#invoice_content').html(data);

            },
            complete: function (xhr, status) {
                $("#invoice_content").print({
                    // Use Global styles
                    globalStyles: false,
                    // Add link with attrbute media=print
                    mediaPrint: false,
                    //Custom stylesheet
                    stylesheet: "http://fonts.googleapis.com/css?family=Roboto",
                    //Print in a hidden iframe
                    iframe: true,
                    // Don't print this
                    noPrintSelector: ".avoid-this",
                    // Add this on top
                    append: "<a style=" + "font-size:9px;font-family:Arial,Helvetica,sans-serif;" + ">Liên hệ với chúng tôi qua email và số điện thoại nếu cần tư vấn.</a><br/>",
                    // Add this at bottom
                    prepend: "<a style=" + "font-size:9px;font-family:Arial,Helvetica,sans-serif;" + ">Cửa hàng Redcart</a><br/>",
                    // Manually add form values
                    manuallyCopyFormValues: true,
                    // resolves after print and restructure the code for better maintainability
                    deferred: $.Deferred(),
                    // timeout
                    timeout: 250,
                    // Custom title
                    title: null,
                    // Custom document type
                    doctype: '<!doctype html>'
                });
            }
        });


    });

    var delivery_address_id_selected = 0;

    function openDivCreateTransport() {
        $('#div_create_transport').removeClass('hidden_element');
        $('#icon_cancel_div_create_transport').removeClass('hidden_element');
        $('#btn_open_div_create_transport').addClass('hidden_element');
    }

    function closeDivCreateTransport() {
        $('#div_create_transport').addClass('hidden_element');
        $('#icon_cancel_div_create_transport').addClass('hidden_element');
        $('#btn_open_div_create_transport').removeClass('hidden_element');
    }

    function showPaymentInformation(order_log_id) {
        $('#modalShowPaymentInformation_' + order_log_id).modal('show');
    }

    function createTransport() {
        var warehouse_to_get = $('#warehouse_to_get option:selected').text();
        var transport_description = $('#transport_description').val();
        var waybill_code = $('#waybill_code').val().trim();
        var package_weight = $('#package_weight').val();
        var package_lenght = $('#package_lenght').val();
        var package_width = $('#package_width').val();
        var package_height = $('#package_height').val();
        var transport_method = $('#transport_method option:selected').text();
        var transport_service = $('#transport_service option:selected').text();
        var allow_check_product = $('#allow_check_product').is(':checked');;
        var get_cost_cod = 0;
        if (@Model.payment_method_id == 3) {
            get_cost_cod = $('#get_cost_cod').autoNumeric('get');
        }

        $.ajax({
            url: "/Order/CreateTransport",
            data: {
                order_id: @Model.order_id,
                get_cost_cod: get_cost_cod,
                package_height: package_height,
                package_width: package_width,
                package_lenght: package_lenght,
                package_weight: package_weight,
                allow_check_product: allow_check_product,
                waybill_code: waybill_code,
                transport_description: transport_description,
                transport_service: transport_service,
                transport_method: transport_method,
                warehouse_to_get: warehouse_to_get,
            },
            context: document.body,
            type: "POST",
            dataType: "html",
            beforeSend: function () {
                $('#btn_create_transport').addClass('buttonload disabled');
                $('.fa-spin').remove();
                $('#btn_create_transport').append('<i class="fa fa-spinner fa-spin"></i>');
            },
            success: function (data) {
                var data_json = JSON.parse(data);

                $('#transport_code_text').text("#T" + data_json.transport_id);
                $('#transport_code_text').attr("href", "/Transport/TransportDetail?id=" + data_json.transport_id);
                $('#transport_service_text').text(transport_service);
                $('#warehouse_to_get_text').text(warehouse_to_get);
                $('#waybill_code_text').text(waybill_code);
                $('#package_weight_text').text(package_weight);
                $('#package_size_text').text(package_lenght + " x " + package_width + " x " + package_height);
                if (@Model.payment_method_id == 3) {
                    $('#get_cost_cod_text').autoNumeric('set', get_cost_cod);
                } else {
                    $('#get_cost_cod_text').addClass('hidden_element');
                    $('#not_get_cod').removeClass('hidden_element');
                }

                $('#div_has_transport').removeClass('hidden_element');
                $('#div_has_not_transport').addClass('hidden_element');
                //$("#show_log_of_order").html($(data_json.list_order_log).find("#show_log_of_order"));
                data_json = JSON.parse(data);
                $('#text_header_user_update').text(data_json.user_update);
                var now_update = new Date();
                var current_time_upadate = now_update.getHours() + ':' + now_update.getMinutes();
                if (now_update.getMinutes().toString().length == 1) {
                    current_time_upadate = now_update.getHours() + ':0' + now_update.getMinutes();
                }
                $('#text_header_datetime_update').text("Hôm nay " + current_time_upadate);
                updateOrderLog(@Model.order_id);
                showToast("success", "Vận chuyển đã được tạo.", "Tạo thành công");
            },
            error: function (xhr, status) {
                showToast("error", "Vui lòng kiểm tra lại dữ liệu vừa nhập.", "Lỗi");
            },
            complete: function (xhr, status) {
                $('#btn_create_transport').removeClass('buttonload disabled');
                $('.fa-spin').remove();
            }
        });
    }

    function openModalConfirmPayment() {
        $('#modalConfirmPayment').modal('show');
    }

    function openModalConfirmOrder() {
        $('#modalConfirmOrder').modal('show');
    }

    function confirmOrder(order_id) {
        $('#modalConfirmOrder').modal('hide');
        $.ajax({
            url: "/Order/ConfirmOrder",
            data: {
                order_id: order_id,
            },
            context: document.body,
            type: "POST",
            dataType: "html",
            beforeSend: function () {
                $('#loading_request_ajax').removeClass('hidden_element');
            },
            success: function (data) {
                showToast("success", "Đơn hàng đã được xác thực.", "Xác thực thành công");
                $('#btn_confirm_order').remove();
                $('#div_confirm_order').empty();
                $('#div_confirm_order').append('<a class="font-18 text-success"><i class="fe fe-check-square"></i></a> &nbsp;'+
                            '<label> ĐÃ XÁC THỰC ĐƠN HÀNG </label>');
                data_json = JSON.parse(data);
                $('#text_header_user_update').text(data_json.user_update);
                var now_update = new Date();
                var current_time_upadate = now_update.getHours() + ':' + now_update.getMinutes();
                if (now_update.getMinutes().toString().length == 1) {
                    current_time_upadate = now_update.getHours() + ':0' + now_update.getMinutes();
                }
                $('#text_header_datetime_update').text("Hôm nay " + current_time_upadate);
                updateOrderLog(@Model.order_id);
            },
            error: function (xhr, status) {
                showToast("error", "Vui lòng kiểm tra lại dữ liệu vừa nhập.", "Lỗi");
            },
            complete: function (xhr, status) {
                $('#loading_request_ajax').addClass('hidden_element');
            }
        });
    }

    function confirmPayment(order_id) {
        var amount_received = @ViewBag.TotalCostOfOrder;
        $.ajax({
            url: "/Order/ConfirmPayment",
            data: {
                order_id: order_id,
                amount_received: amount_received
            },
            context: document.body,
            type: "POST",
            dataType: "html",
            beforeSend: function () {

            },
            success: function (data) {
                showToast("success", "Đơn hàng đã được xác nhận thanh toán.", "Xác nhận thành công");
                $('#btn_confirm_payment').remove();
                $('#div_confirm_payment').empty();
                $('#div_confirm_payment').append('<a class="font-18 text-success"><i class="fe fe-check-square"></i></a> &nbsp;'+
                            '<label class=""> THANH TOÁN <span class="showNumeric font-bold text-info">@ViewBag.TotalCostOfOrder</span> ĐƯỢC CHẤP NHẬN</label>');
                $(".showNumeric").autoNumeric('init', { aSign: ' ₫', pSign: 's', mDec: '0', aSep: '.', aDec: ',' });
                data_json = JSON.parse(data);
                $('#text_header_user_update').text(data_json.user_update);
                var now_update = new Date();
                var current_time_upadate = now_update.getHours() + ':' + now_update.getMinutes();
                if (now_update.getMinutes().toString().length == 1) {
                    current_time_upadate = now_update.getHours() + ':0' + now_update.getMinutes();
                }
                $('#text_header_datetime_update').text("Hôm nay " + current_time_upadate);
                updateOrderLog(@Model.order_id);
                $('#modalConfirmPayment').modal('hide');
            },
            error: function (xhr, status) {
                showToast("error", "Vui lòng kiểm tra lại dữ liệu vừa nhập.", "Lỗi");
            },
            complete: function (xhr, status) {

            }
        });
    }

    function openModalUpdateWaybillCode() {
        $('#modalUpdateWaybillCode').modal('show');
    }

    function confirmUpdateWaybillCode(transport_id) {
        var waybill_code = $('#waybill_code').val();
        if (waybill_code == "" || waybill_code == null) {
            $('#waybill_code_feedback').css({ display: 'block' });
            $('#waybill_code').addClass('is-invalid');
            showToast("error", "Mã vận đơn không được để trống.", "Lỗi");
        } else {
            $('#waybill_code_feedback').css({ display: 'none' });
            $('#waybill_code').removeClass('is-invalid');

            $.ajax({
                url: "/Transport/UpdateWaybillCode",
                data: {
                    transport_id: transport_id,
                    waybill_code: waybill_code
                },
                context: document.body,
                type: "POST",
                dataType: "html",
                beforeSend: function () {

                },
                success: function (data) {
                    $('#show_text_waybill_code').text(waybill_code);
                    showToast("success", "Mã vận đơn đã được cập nhật.", "Cập nhật thành công");

                    data_json = JSON.parse(data);
                    $('#text_header_user_update').text(data_json.user_update);
                    var now_update = new Date();
                    var current_time_upadate = now_update.getHours() + ':' + now_update.getMinutes();
                    if (now_update.getMinutes().toString().length == 1) {
                        current_time_upadate = now_update.getHours() + ':0' + now_update.getMinutes();
                    }
                    $('#text_header_datetime_update').text("Hôm nay " + current_time_upadate);
                    updateOrderLog(@Model.order_id);
                    $('#modalUpdateWaybillCode').modal('hide');
                },
                error: function (xhr, status) {
                    showToast("error", "Vui lòng kiểm tra lại dữ liệu vừa nhập.", "Lỗi");
                },
                complete: function (xhr, status) {

                }
            });
        }
    }

    function updateOrderLog(order_id) {
        $.ajax({
            url: '@Url.Action("GetOrderLog", "Order")',
            context: document.body,
            type: "POST",
            dataType: "html",
            data: { order_id: order_id },
            success: function (result) {
                $('#data_order_log').html(result);
            }
        });
    }

    function addNewOrderLog() {
        var content = $('#content_add_order_log').val();
        var order_id = @Model.order_id;
        $.ajax({
            url: "/Order/AddOrderLog",
            data: {
                order_id: order_id,
                content: content
            },
            context: document.body,
            type: "POST",
            dataType: "html",
            beforeSend: function () {

            },
            success: function (data) {
                updateOrderLog(@Model.order_id);
                $('#content_add_order_log').val("");
                showToast("success", "Ghi chú mới đã được tạo.", "Tạo thành công");
            },
            error: function (xhr, status) {
                showToast("error", "Vui lòng kiểm tra lại dữ liệu vừa nhập.", "Lỗi");
            },
            complete: function (xhr, status) {

            }
        });
    }

    $('#content_add_order_log').keypress(function (e) {
        if (e.which == 13) {
            addNewOrderLog();
        }
    });

    function printInvoice() {
        //var divToPrint = document.getElementById('invoice_content');
        //var newWin = window.open('', 'Print-Window');
        //newWin.document.open();
        //newWin.document.write('<html><body onload="window.print()">' + divToPrint.innerHTML + '</body></html>');
        //newWin.document.close();
        //setTimeout(function () {
        //    newWin.close();
        //}, 10);
    }

    function showModalDeleteThisOrder() {
        $('#modalConfirmDeleteOrder').modal('show');
    }

    function deleteOrder(order_id) {
        $.ajax({
            url: "/Order/DeleteOrder",
            data: {
                order_id: order_id
            },
            context: document.body,
            type: "POST",
            dataType: "html",
            success: function (data) {
                var date_obj = new Date();
                var minutes = 30;
                date_obj.setTime(date_obj.getTime() + (minutes * 60 * 1000));

                Cookies.set("delete_order_success", "" + order_id, { expires: date_obj });
                var url = '/Order/Index';
                window.location.href = url;
            },
            error: function (xhr, status) {
                toastError();
            },
            complete: function (xhr, status) {
            }
        });
    }
</script>
